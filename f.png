example 25



PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVzIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+U29uaWNDaGF0IFBybyB2NDwvdGl0bGU+CiAgICA8c3R5bGU+CiAgICAgICAgOnJvb3QgeyAtLWJnOiAjMTExODI3OyAtLXBhbmVsOiAjMWYyOTM3OyAtLWFjY2VudDogIzNiODJmNjsgLS10ZXh0OiAjZjNmNGY2OyAtLXJlY2VpdmVkOiAjMzc0MTUxOyB9CiAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiAnU2Vnb2UgVUknLCBzeXN0ZW0tdWksIHNhbnMtc2VyaWY7IGJhY2tncm91bmQ6IHZhcigtLWJnKTsgY29sb3I6IHZhcigtLXRleHQpOyBtYXJnaW46IDA7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGhlaWdodDogMTAwdmg7IG92ZXJmbG93OiBoaWRkZW47IH0KICAgICAgICAKICAgICAgICAvKiBIRUFERVIgKi8KICAgICAgICBoZWFkZXIgeyBiYWNrZ3JvdW5kOiB2YXIoLS1wYW5lbCk7IHBhZGRpbmc6IDE1cHg7IGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjMzMzOyBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7IHotaW5kZXg6IDEwOyB9CiAgICAgICAgLnN0YXR1cy1iYWRnZSB7IGJhY2tncm91bmQ6ICNkYzI2MjY7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogNHB4IDEwcHg7IGJvcmRlci1yYWRpdXM6IDEycHg7IGZvbnQtc2l6ZTogMC44cmVtOyBmb250LXdlaWdodDogYm9sZDsgdHJhbnNpdGlvbjogMC4zczsgfQogICAgICAgIC5zdGF0dXMtYmFkZ2UuYWN0aXZlIHsgYmFja2dyb3VuZDogIzE2YTM0YTsgYm94LXNoYWRvdzogMCAwIDEwcHggIzE2YTM0YTsgfQogICAgICAgIAogICAgICAgICNidG5Qb3dlciB7IGJhY2tncm91bmQ6IHZhcigtLWFjY2VudCk7IGNvbG9yOiB3aGl0ZTsgYm9yZGVyOiBub25lOyBwYWRkaW5nOiA4cHggMjBweDsgYm9yZGVyLXJhZGl1czogNnB4OyBmb250LXdlaWdodDogYm9sZDsgY3Vyc29yOiBwb2ludGVyOyB9CiAgICAgICAgI2J0blBvd2VyOmhvdmVyIHsgYmFja2dyb3VuZDogIzI1NjNlYjsgfQogICAgICAgIAogICAgICAgIC8qIERFQlVHIEJBUiAqLwogICAgICAgICNkZWJ1Zy1wYW5lbCB7IGJhY2tncm91bmQ6ICMwMDA7IHBhZGRpbmc6IDVweCAxNXB4OyBmb250LXNpemU6IDAuNzVyZW07IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTBweDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMzMzM7IH0KICAgICAgICAubWV0ZXItY29udGFpbmVyIHsgZmxleDogMTsgaGVpZ2h0OiA2cHg7IGJhY2tncm91bmQ6ICMzMzM7IGJvcmRlci1yYWRpdXM6IDNweDsgb3ZlcmZsb3c6IGhpZGRlbjsgcG9zaXRpb246IHJlbGF0aXZlOyB9CiAgICAgICAgLm1ldGVyLWZpbGwgeyBoZWlnaHQ6IDEwMCU7IGJhY2tncm91bmQ6ICMxNmEzNGE7IHdpZHRoOiAwJTsgdHJhbnNpdGlvbjogd2lkdGggMC4wNXM7IH0KICAgICAgICAudGhyZXNob2xkLW1hcmtlciB7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBib3R0b206IDA7IHdpZHRoOiAycHg7IGJhY2tncm91bmQ6ICNlZjQ0NDQ7IHotaW5kZXg6IDI7IH0KICAgICAgICBpbnB1dFt0eXBlPXJhbmdlXSB7IHdpZHRoOiAxMDBweDsgfQoKICAgICAgICAvKiBDSEFUIEFSRUEgKi8KICAgICAgICAjY2hhdC1hcmVhIHsgZmxleDogMTsgb3ZlcmZsb3cteTogYXV0bzsgcGFkZGluZzogMjBweDsgZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgZ2FwOiAxMnB4OyB9CiAgICAgICAgCiAgICAgICAgLm1zZyB7IG1heC13aWR0aDogODAlOyBwYWRkaW5nOiAxMHB4IDE0cHg7IGJvcmRlci1yYWRpdXM6IDEycHg7IGZvbnQtc2l6ZTogMC45NXJlbTsgbGluZS1oZWlnaHQ6IDEuNDsgcG9zaXRpb246IHJlbGF0aXZlOyBhbmltYXRpb246IHNsaWRlSW4gMC4ycyBlYXNlLW91dDsgfQogICAgICAgIC5tc2cuc2VudCB7IGFsaWduLXNlbGY6IGZsZXgtZW5kOyBiYWNrZ3JvdW5kOiB2YXIoLS1hY2NlbnQpOyBjb2xvcjogd2hpdGU7IGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAycHg7IH0KICAgICAgICAubXNnLnJlY2VpdmVkIHsgYWxpZ24tc2VsZjogZmxleC1zdGFydDsgYmFja2dyb3VuZDogdmFyKC0tcmVjZWl2ZWQpOyBjb2xvcjogI2U1ZTdlYjsgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMnB4OyBib3JkZXI6IDFweCBzb2xpZCAjNGI1NTYzOyB9CiAgICAgICAgLm1zZy5zeXN0ZW0geyBhbGlnbi1zZWxmOiBjZW50ZXI7IGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4xKTsgZm9udC1zaXplOiAwLjhyZW07IHBhZGRpbmc6IDRweCAxMnB4OyBib3JkZXItcmFkaXVzOiAyMHB4OyBjb2xvcjogIzljYTNhZjsgfQogICAgICAgIAogICAgICAgIC5maWxlLWxpbmsgeyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDEwcHg7IGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4yKTsgcGFkZGluZzogOHB4OyBib3JkZXItcmFkaXVzOiA2cHg7IG1hcmdpbi10b3A6IDVweDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBjb2xvcjogaW5oZXJpdDsgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjEpOyB9CiAgICAgICAgCiAgICAgICAgLyogSU5QVVQgQVJFQSAqLwogICAgICAgIGZvb3RlciB7IGJhY2tncm91bmQ6IHZhcigtLXBhbmVsKTsgcGFkZGluZzogMTVweDsgYm9yZGVyLXRvcDogMXB4IHNvbGlkICMzMzM7IGRpc3BsYXk6IGZsZXg7IGdhcDogMTBweDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgfQogICAgICAgIGlucHV0W3R5cGU9InRleHQiXSB7IGZsZXg6IDE7IHBhZGRpbmc6IDEycHg7IGJhY2tncm91bmQ6ICMxMTE4Mjc7IGJvcmRlcjogMXB4IHNvbGlkICMzNzQxNTE7IGNvbG9yOiB3aGl0ZTsgYm9yZGVyLXJhZGl1czogMjBweDsgb3V0bGluZTogbm9uZTsgfQogICAgICAgIGlucHV0W3R5cGU9InRleHQiXTpmb2N1cyB7IGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50KTsgfQogICAgICAgIAogICAgICAgIGJ1dHRvbi5pY29uIHsgYmFja2dyb3VuZDogbm9uZTsgYm9yZGVyOiBub25lOyBjb2xvcjogIzljYTNhZjsgY3Vyc29yOiBwb2ludGVyOyBmb250LXNpemU6IDEuMnJlbTsgcGFkZGluZzogOHB4OyB0cmFuc2l0aW9uOiAwLjJzOyB9CiAgICAgICAgYnV0dG9uLmljb246aG92ZXIgeyBjb2xvcjogd2hpdGU7IGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4xKTsgYm9yZGVyLXJhZGl1czogNTAlOyB9CiAgICAgICAgYnV0dG9uLnNlbmQtYnRuIHsgYmFja2dyb3VuZDogdmFyKC0tYWNjZW50KTsgY29sb3I6IHdoaXRlOyBib3JkZXI6IG5vbmU7IHdpZHRoOiA0MHB4OyBoZWlnaHQ6IDQwcHg7IGJvcmRlci1yYWRpdXM6IDUwJTsgY3Vyc29yOiBwb2ludGVyOyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgfQogICAgICAgIAogICAgICAgIEBrZXlmcmFtZXMgc2xpZGVJbiB7IGZyb20geyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTBweCk7IG9wYWNpdHk6IDA7IH0gdG8geyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IG9wYWNpdHk6IDE7IH0gfQogICAgICAgIAogICAgICAgIC8qIEhJRERFTiAqLwogICAgICAgICNmaWxlSW5wdXQgeyBkaXNwbGF5OiBub25lOyB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgoKPGhlYWRlcj4KICAgIDxkaXYgY2xhc3M9InN0YXR1cy1iYWRnZSIgaWQ9InN0YXR1c0JhZGdlIj5PRkZMSU5FPC9kaXY+CiAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDpib2xkOyBmb250LXNpemU6MS4xcmVtOyI+8J+UiiBTb25pY0NoYXQgdjQ8L2Rpdj4KICAgIDxidXR0b24gaWQ9ImJ0blBvd2VyIj5BQ1RJVkFSPC9idXR0b24+CjwvaGVhZGVyPgoKPGRpdiBpZD0iZGVidWctcGFuZWwiPgogICAgPHNwYW4+Vm9sdW1lbiBNaWM6PC9zcGFuPgogICAgPGRpdiBjbGFzcz0ibWV0ZXItY29udGFpbmVyIj4KICAgICAgICA8ZGl2IGNsYXNzPSJtZXRlci1maWxsIiBpZD0idm9sTWV0ZXIiPjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InRocmVzaG9sZC1tYXJrZXIiIGlkPSJ0aHJlc2hNYXJrZXIiIHN0eWxlPSJsZWZ0OiAyMCU7Ij48L2Rpdj4KICAgIDwvZGl2PgogICAgPHNwYW4+U2Vuc2liaWxpZGFkOjwvc3Bhbj4KICAgIDxpbnB1dCB0eXBlPSJyYW5nZSIgaWQ9InNlbnNSYW5nZSIgbWluPSI1IiBtYXg9IjEwMCIgdmFsdWU9IjIwIj4KPC9kaXY+Cgo8ZGl2IGlkPSJjaGF0LWFyZWEiPgogICAgPGRpdiBjbGFzcz0ibXNnIHN5c3RlbSI+UHJlc2lvbmEgQUNUSVZBUiBlbiBhbWJvcyBkaXNwb3NpdGl2b3MgcGFyYSBlbXBlemFyLjwvZGl2Pgo8L2Rpdj4KCjxmb290ZXI+CiAgICA8bGFiZWwgY2xhc3M9Imljb24iIHRpdGxlPSJBZGp1bnRhciI+8J+TjiA8aW5wdXQgdHlwZT0iZmlsZSIgaWQ9ImZpbGVJbnB1dCI+PC9sYWJlbD4KICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ibXNnSW5wdXQiIHBsYWNlaG9sZGVyPSJFc2NyaWJlIHVuIG1lbnNhamUuLi4iIGRpc2FibGVkPgogICAgPGJ1dHRvbiBjbGFzcz0ic2VuZC1idG4iIGlkPSJidG5TZW5kIiBkaXNhYmxlZD7inqQ8L2J1dHRvbj4KPC9mb290ZXI+Cgo8c2NyaXB0PgogICAgLy8gLS0tIENPTkZJR1VSQUNJw5NOIC0tLQogICAgY29uc3QgQ0ZHID0gewogICAgICAgIGJhdWQ6IDI1LCAgICAgICAgICAgLy8gVmVsb2NpZGFkIChiaXRzL3NlZykuIEJhamFyIHNpIGhheSBlcnJvcmVzLgogICAgICAgIGZyZXEwOiAxMjAwLCAgICAgICAgLy8gVG9ubyBncmF2ZSAoMCkKICAgICAgICBmcmVxMTogMjIwMCwgICAgICAgIC8vIFRvbm8gYWd1ZG8gKDEpCiAgICAgICAgdGhyZXNob2xkOiAyMCAgICAgICAvLyBTZW5zaWJpbGlkYWQgaW5pY2lhbCAoMC0yNTUpCiAgICB9OwoKICAgIGxldCBhdWRpb0N0eCwgYW5hbHlzZXI7CiAgICBsZXQgaXNDb25uZWN0ZWQgPSBmYWxzZTsKICAgIGxldCBpc1R4ID0gZmFsc2U7CgogICAgLy8gLS0tIEVMRU1FTlRPUyBET00gLS0tCiAgICBjb25zdCB1aSA9IHsKICAgICAgICBzdGF0dXM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0dXNCYWRnZScpLAogICAgICAgIGJ0blBvd2VyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuUG93ZXInKSwKICAgICAgICBjaGF0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdC1hcmVhJyksCiAgICAgICAgaW5wdXQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtc2dJbnB1dCcpLAogICAgICAgIGJ0blNlbmQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5TZW5kJyksCiAgICAgICAgbWV0ZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2b2xNZXRlcicpLAogICAgICAgIG1hcmtlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RocmVzaE1hcmtlcicpLAogICAgICAgIHNsaWRlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbnNSYW5nZScpLAogICAgICAgIGZpbGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKQogICAgfTsKCiAgICAvLyAtLS0gMS4gRU5DRU5ESURPIC0tLQogICAgdWkuYnRuUG93ZXIub25jbGljayA9IGFzeW5jICgpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgICBhdWRpb0N0eCA9IG5ldyAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSgpOwogICAgICAgICAgICBjb25zdCBzdHJlYW0gPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7CiAgICAgICAgICAgICAgICBhdWRpbzogewogICAgICAgICAgICAgICAgICAgIGVjaG9DYW5jZWxsYXRpb246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIG5vaXNlU3VwcHJlc3Npb246IGZhbHNlLCAvLyBDUsONVElDTzogRGVzYWN0aXZhciBzdXByZXNpw7NuCiAgICAgICAgICAgICAgICAgICAgYXV0b0dhaW5Db250cm9sOiBmYWxzZSAgIC8vIENSw41USUNPOiBHYW5hbmNpYSBtYW51YWwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBDb25maWd1cmFyIFJlY2VwdG9yCiAgICAgICAgICAgIGNvbnN0IHNvdXJjZSA9IGF1ZGlvQ3R4LmNyZWF0ZU1lZGlhU3RyZWFtU291cmNlKHN0cmVhbSk7CiAgICAgICAgICAgIGFuYWx5c2VyID0gYXVkaW9DdHguY3JlYXRlQW5hbHlzZXIoKTsKICAgICAgICAgICAgYW5hbHlzZXIuZmZ0U2l6ZSA9IDEwMjQ7CiAgICAgICAgICAgIGFuYWx5c2VyLnNtb290aGluZ1RpbWVDb25zdGFudCA9IDAuMjsKICAgICAgICAgICAgc291cmNlLmNvbm5lY3QoYW5hbHlzZXIpOwoKICAgICAgICAgICAgaXNDb25uZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICB1aS5zdGF0dXMuaW5uZXJUZXh0ID0gIk9OTElORSAoRXNjdWNoYW5kbykiOwogICAgICAgICAgICB1aS5zdGF0dXMuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIHVpLmJ0blBvd2VyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIHVpLmlucHV0LmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHVpLmJ0blNlbmQuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHN0YXJ0TGlzdGVuaW5nKCk7CiAgICAgICAgICAgIGFkZFN5c3RlbU1zZygiTWljcm9mb25vIGFjdGl2by4gQWp1c3RhIGVsIHZvbHVtZW4gYWwgbcOheGltby4iKTsKCiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBhbGVydCgiRXJyb3I6IE5vIHNlIHB1ZG8gYWNjZWRlciBhbCBtaWNyw7Nmb25vLiIpOwogICAgICAgIH0KICAgIH07CgogICAgLy8gLS0tIDIuIFRSQU5TTUlTScOTTiAoVFgpIC0tLQogICAgCiAgICAvLyBGdW5jacOzbiBwYXJhIG1hbmVqYXIgZWwgZW52w61vCiAgICBjb25zdCBoYW5kbGVTZW5kID0gKCkgPT4gewogICAgICAgIGNvbnN0IHRleHQgPSB1aS5pbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgaWYgKCF0ZXh0KSByZXR1cm47CiAgICAgICAgdWkuaW5wdXQudmFsdWUgPSAnJzsKICAgICAgICBhZGRNc2codGV4dCwgJ3NlbnQnKTsKICAgICAgICAKICAgICAgICBjb25zdCBwYXlsb2FkID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKHRleHQpOwogICAgICAgIHRyYW5zbWl0KDEsIHBheWxvYWQpOyAvLyBUaXBvIDEgPSBUZXh0bwogICAgfTsKCiAgICAvLyBFdmVudG8gQ2xpY2sKICAgIHVpLmJ0blNlbmQub25jbGljayA9IGhhbmRsZVNlbmQ7CgogICAgLy8gRXZlbnRvIEVOVEVSCiAgICB1aS5pbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGUpID0+IHsKICAgICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicpIGhhbmRsZVNlbmQoKTsKICAgIH0pOwoKICAgIC8vIEVudmlhciBBcmNoaXZvCiAgICB1aS5maWxlLm9uY2hhbmdlID0gYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IGZpbGUgPSB1aS5maWxlLmZpbGVzWzBdOwogICAgICAgIGlmKCFmaWxlKSByZXR1cm47CiAgICAgICAgCiAgICAgICAgYWRkTXNnKGBFbnZpYW5kbyAke2ZpbGUubmFtZX0uLi5gLCAnc2VudCcpOwogICAgICAgIAogICAgICAgIGNvbnN0IG5hbWVCeXRlcyA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShmaWxlLm5hbWUpOwogICAgICAgIGNvbnN0IGZpbGVCeXRlcyA9IG5ldyBVaW50OEFycmF5KGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKSk7CiAgICAgICAgCiAgICAgICAgLy8gUHJvdG9jb2xvOiBbTGVuTm9tYnJlXSArIFtOb21icmVdICsgW0RhdGFdCiAgICAgICAgY29uc3QgcGF5bG9hZCA9IG5ldyBVaW50OEFycmF5KDEgKyBuYW1lQnl0ZXMubGVuZ3RoICsgZmlsZUJ5dGVzLmxlbmd0aCk7CiAgICAgICAgcGF5bG9hZFswXSA9IG5hbWVCeXRlcy5sZW5ndGg7CiAgICAgICAgcGF5bG9hZC5zZXQobmFtZUJ5dGVzLCAxKTsKICAgICAgICBwYXlsb2FkLnNldChmaWxlQnl0ZXMsIDEgKyBuYW1lQnl0ZXMubGVuZ3RoKTsKICAgICAgICAKICAgICAgICB0cmFuc21pdCgyLCBwYXlsb2FkKTsKICAgICAgICB1aS5maWxlLnZhbHVlID0gJyc7CiAgICB9OwoKICAgIGFzeW5jIGZ1bmN0aW9uIHRyYW5zbWl0KHR5cGUsIGRhdGEpIHsKICAgICAgICBpZihpc1R4KSByZXR1cm47CiAgICAgICAgaXNUeCA9IHRydWU7CiAgICAgICAgdWkuaW5wdXQuZGlzYWJsZWQgPSB0cnVlOwoKICAgICAgICAvLyBDb25zdHJ1aXIgUGFxdWV0ZTogW1BSRUFNQlVMT10gW1RJUE9dIFtMRU5fSEldIFtMRU5fTE9dIFtEQVRBXQogICAgICAgIC8vIFByZWFtYnVsbzogMHhBQSAoMTAxMDEwMTApIHBhcmEgc2luY3Jvbml6YXIgcmVsb2oKICAgICAgICBjb25zdCBsZW4gPSBkYXRhLmxlbmd0aDsKICAgICAgICBjb25zdCBwYWNrZXQgPSBuZXcgVWludDhBcnJheSg0ICsgbGVuKTsKICAgICAgICBwYWNrZXRbMF0gPSAweEFBOyAvLyBTeW5jCiAgICAgICAgcGFja2V0WzFdID0gdHlwZTsKICAgICAgICBwYWNrZXRbMl0gPSAobGVuID4+IDgpICYgMHhGRjsKICAgICAgICBwYWNrZXRbM10gPSBsZW4gJiAweEZGOwogICAgICAgIHBhY2tldC5zZXQoZGF0YSwgNCk7CgogICAgICAgIGNvbnN0IG9zYyA9IGF1ZGlvQ3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTsKICAgICAgICBjb25zdCBnYWluID0gYXVkaW9DdHguY3JlYXRlR2FpbigpOwogICAgICAgIG9zYy5jb25uZWN0KGdhaW4pOwogICAgICAgIGdhaW4uY29ubmVjdChhdWRpb0N0eC5kZXN0aW5hdGlvbik7CiAgICAgICAgb3NjLnN0YXJ0KCk7CgogICAgICAgIGNvbnN0IGJpdER1cmF0aW9uID0gMSAvIENGRy5iYXVkOwogICAgICAgIGxldCB0ID0gYXVkaW9DdHguY3VycmVudFRpbWUgKyAwLjA1OwoKICAgICAgICAvLyBUb25vIFBpbG90byAoRGVzcGVydGFyIEFHQyBkZWwgb3RybyBsYWRvKQogICAgICAgIG9zYy5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoQ0ZHLmZyZXExLCB0IC0gMC41KTsKICAgICAgICAKICAgICAgICBmb3IobGV0IGJ5dGUgb2YgcGFja2V0KSB7CiAgICAgICAgICAgIC8vIFNUQVJUIEJJVCAoMCkKICAgICAgICAgICAgb3NjLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZShDRkcuZnJlcTAsIHQpOwogICAgICAgICAgICB0ICs9IGJpdER1cmF0aW9uOwoKICAgICAgICAgICAgLy8gOCBEQVRBIEJJVFMKICAgICAgICAgICAgZm9yKGxldCBiPTA7IGI8ODsgYisrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiaXQgPSAoYnl0ZSA+PiBiKSAmIDE7CiAgICAgICAgICAgICAgICBvc2MuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKGJpdCA/IENGRy5mcmVxMSA6IENGRy5mcmVxMCwgdCk7CiAgICAgICAgICAgICAgICB0ICs9IGJpdER1cmF0aW9uOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTVE9QIEJJVCAoMSkKICAgICAgICAgICAgb3NjLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZShDRkcuZnJlcTEsIHQpOwogICAgICAgICAgICB0ICs9IGJpdER1cmF0aW9uOwogICAgICAgIH0KCiAgICAgICAgb3NjLnN0b3AodCk7CiAgICAgICAgCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIGlzVHggPSBmYWxzZTsKICAgICAgICAgICAgdWkuaW5wdXQuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgdWkuaW5wdXQuZm9jdXMoKTsKICAgICAgICB9LCAodCAtIGF1ZGlvQ3R4LmN1cnJlbnRUaW1lKSAqIDEwMDAgKyAxMDApOwogICAgfQoKICAgIC8vIC0tLSAzLiBSRUNFUENJw5NOIChSWCkgLSBMw7NnaWNhIE1lam9yYWRhIC0tLQogICAgCiAgICAvLyBBanVzdGUgZGUgc2xpZGVyIGRlIHNlbnNpYmlsaWRhZAogICAgdWkuc2xpZGVyLm9uaW5wdXQgPSAoZSkgPT4gewogICAgICAgIENGRy50aHJlc2hvbGQgPSBwYXJzZUludChlLnRhcmdldC52YWx1ZSk7CiAgICAgICAgdWkubWFya2VyLnN0eWxlLmxlZnQgPSAoQ0ZHLnRocmVzaG9sZCAvIDIuNTUpICsgIiUiOyAvLyAyNTUgbWF4IHZhbHVlCiAgICB9OwoKICAgIGZ1bmN0aW9uIHN0YXJ0TGlzdGVuaW5nKCkgewogICAgICAgIGNvbnN0IGRhdGFBcnJheSA9IG5ldyBVaW50OEFycmF5KGFuYWx5c2VyLmZyZXF1ZW5jeUJpbkNvdW50KTsKICAgICAgICBjb25zdCBiaXRUaW1lID0gMTAwMCAvIENGRy5iYXVkOwogICAgICAgIAogICAgICAgIGxldCBzdGF0ZSA9IDA7IC8vIDA9SWRsZSwgMT1EYXRhCiAgICAgICAgbGV0IHJ4Qnl0ZSA9IDA7CiAgICAgICAgbGV0IGJpdElkeCA9IDA7CiAgICAgICAgbGV0IGxhc3RUaW1lID0gMDsKICAgICAgICBsZXQgaW5CeXRlID0gZmFsc2U7CgogICAgICAgIC8vIEJ1ZmZlcnMgcGFyYSBlbCBtZW5zYWplCiAgICAgICAgbGV0IG1zZ1R5cGUgPSAwOwogICAgICAgIGxldCBtc2dMZW4gPSAwOwogICAgICAgIGxldCBtc2dCdWZmZXIgPSBbXTsKICAgICAgICBsZXQgaGVhZGVyU3RlcCA9IDA7IC8vIDA9VHlwZSwgMT1MZW5IaSwgMj1MZW5MbwoKICAgICAgICBjb25zdCBsb29wID0gKHRpbWVzdGFtcCkgPT4gewogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7CiAgICAgICAgICAgIGlmKGlzVHgpIHJldHVybjsKCiAgICAgICAgICAgIGFuYWx5c2VyLmdldEJ5dGVGcmVxdWVuY3lEYXRhKGRhdGFBcnJheSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAxLiBBbsOhbGlzaXMgZGUgVm9sdW1lbiAoUGFyYSBlbCBkZWJ1ZyBiYXIpCiAgICAgICAgICAgIGxldCBtYXhWb2wgPSAwLCBtYXhJZHggPSAwOwogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxkYXRhQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmKGRhdGFBcnJheVtpXSA+IG1heFZvbCkgeyBtYXhWb2wgPSBkYXRhQXJyYXlbaV07IG1heElkeCA9IGk7IH0KICAgICAgICAgICAgfQogICAgICAgICAgICB1aS5tZXRlci5zdHlsZS53aWR0aCA9IChtYXhWb2wgLyAyLjU1KSArICIlIjsKCiAgICAgICAgICAgIC8vIDIuIENvbnRyb2wgZGUgVGllbXBvIChTYW1wbGluZykKICAgICAgICAgICAgaWYodGltZXN0YW1wIC0gbGFzdFRpbWUgPCBiaXRUaW1lKSByZXR1cm47CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAzLiBEZWNvZGlmaWNhY2nDs24gZGUgQml0CiAgICAgICAgICAgIGxldCBiaXQgPSAtMTsKICAgICAgICAgICAgLy8gU29sbyBwcm9jZXNhciBzaSBlbCB2b2x1bWVuIHN1cGVyYSBlbCB1bWJyYWwgZGVsIHNsaWRlcgogICAgICAgICAgICBpZihtYXhWb2wgPiBDRkcudGhyZXNob2xkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmcmVxID0gbWF4SWR4ICogYXVkaW9DdHguc2FtcGxlUmF0ZSAvIGFuYWx5c2VyLmZmdFNpemU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFRvbGVyYW5jaWEgYW1wbGlhICsvLSAzMDBIegogICAgICAgICAgICAgICAgaWYoTWF0aC5hYnMoZnJlcSAtIENGRy5mcmVxMCkgPCAzMDApIGJpdCA9IDA7CiAgICAgICAgICAgICAgICBlbHNlIGlmKE1hdGguYWJzKGZyZXEgLSBDRkcuZnJlcTEpIDwgMzAwKSBiaXQgPSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA0LiBNw6FxdWluYSBkZSBFc3RhZG9zIFVBUlQKICAgICAgICAgICAgaWYoIWluQnl0ZSkgewogICAgICAgICAgICAgICAgLy8gQnVzY2FuZG8gU1RBUlQgQklUICgwKQogICAgICAgICAgICAgICAgaWYoYml0ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaW5CeXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBiaXRJZHggPSAwOwogICAgICAgICAgICAgICAgICAgIHJ4Qnl0ZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgbGFzdFRpbWUgPSB0aW1lc3RhbXAgKyAoYml0VGltZSAqIDAuNSk7IC8vIEFsaW5lYXIgYWwgY2VudHJvIGRlbCBiaXQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbGFzdFRpbWUgPSB0aW1lc3RhbXA7IC8vIE1hbnRlbmVyIHBvbGxpbmcgcsOhcGlkbyBzaSBubyBoYXkgc3RhcnQgYml0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBMZXllbmRvIGJpdHMKICAgICAgICAgICAgICAgIGlmKGJpdElkeCA8IDgpIHsKICAgICAgICAgICAgICAgICAgICBpZihiaXQgPT09IDEpIHJ4Qnl0ZSB8PSAoMSA8PCBiaXRJZHgpOwogICAgICAgICAgICAgICAgICAgIGJpdElkeCsrOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBTVE9QIEJJVCAtIEJ5dGUgY29tcGxldG8KICAgICAgICAgICAgICAgICAgICBpbkJ5dGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzQnl0ZShyeEJ5dGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGFzdFRpbWUgPSB0aW1lc3RhbXA7IC8vIE1hbnRlbmVyIHJpdG1vCiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBwcm9jZXNzQnl0ZShieXRlKSB7CiAgICAgICAgICAgIC8vIEVzdGFkbyBJRExFOiBCdXNjYW5kbyBTeW5jIEJ5dGUgMHhBQQogICAgICAgICAgICBpZihzdGF0ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgaWYoYnl0ZSA9PT0gMHhBQSkgewogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gMTsgLy8gU2luY3Jvbml6YWRvLCBsZWVyIGNhYmVjZXJhCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyU3RlcCA9IDA7CiAgICAgICAgICAgICAgICAgICAgbXNnQnVmZmVyID0gW107CiAgICAgICAgICAgICAgICAgICAgLy8gSW5kaWNhZG9yIHZpc3VhbCBzdXRpbAogICAgICAgICAgICAgICAgICAgIHVpLnN0YXR1cy5zdHlsZS5jb2xvciA9ICIjNGFkZTgwIjsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gRXN0YWRvIEhFQURFUjogTGV5ZW5kbyBUaXBvIHkgTG9uZ2l0dWQKICAgICAgICAgICAgZWxzZSBpZihzdGF0ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgaWYoaGVhZGVyU3RlcCA9PT0gMCkgbXNnVHlwZSA9IGJ5dGU7CiAgICAgICAgICAgICAgICBlbHNlIGlmKGhlYWRlclN0ZXAgPT09IDEpIG1zZ0xlbiA9IGJ5dGUgPDwgODsKICAgICAgICAgICAgICAgIGVsc2UgaWYoaGVhZGVyU3RlcCA9PT0gMikgewogICAgICAgICAgICAgICAgICAgIG1zZ0xlbiB8PSBieXRlOwogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gMjsgLy8gSGVhZGVyIGxpc3RvLCBsZWVyIHBheWxvYWQKICAgICAgICAgICAgICAgICAgICBhZGRTeXN0ZW1Nc2coIlJlY2liaWVuZG8gZGF0b3MuLi4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhlYWRlclN0ZXArKzsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBFc3RhZG8gQk9EWTogTGV5ZW5kbyBkYXRvcwogICAgICAgICAgICBlbHNlIGlmKHN0YXRlID09PSAyKSB7CiAgICAgICAgICAgICAgICBtc2dCdWZmZXIucHVzaChieXRlKTsKICAgICAgICAgICAgICAgIGlmKG1zZ0J1ZmZlci5sZW5ndGggPj0gbXNnTGVuKSB7CiAgICAgICAgICAgICAgICAgICAgZmluaXNoUngoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZmluaXNoUngoKSB7CiAgICAgICAgICAgIHN0YXRlID0gMDsKICAgICAgICAgICAgdWkuc3RhdHVzLnN0eWxlLmNvbG9yID0gIndoaXRlIjsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KG1zZ0J1ZmZlcik7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZihtc2dUeXBlID09PSAxKSB7IC8vIFRFWFRPCiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGRhdGEpOwogICAgICAgICAgICAgICAgYWRkTXNnKHRleHQsICdyZWNlaXZlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYobXNnVHlwZSA9PT0gMikgeyAvLyBBUkNISVZPCiAgICAgICAgICAgICAgICBjb25zdCBuYW1lTGVuID0gZGF0YVswXTsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGRhdGEuc2xpY2UoMSwgMStuYW1lTGVuKSk7CiAgICAgICAgICAgICAgICBjb25zdCBmaWxlRGF0YSA9IGRhdGEuc2xpY2UoMStuYW1lTGVuKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtmaWxlRGF0YV0pOwogICAgICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgbXNnRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBtc2dEaXYuY2xhc3NOYW1lID0gJ21zZyByZWNlaXZlZCc7CiAgICAgICAgICAgICAgICBtc2dEaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgIDxkaXY+QXJjaGl2byBSZWNpYmlkbzo8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSIke3VybH0iIGRvd25sb2FkPSIke2ZpbGVOYW1lfSIgY2xhc3M9ImZpbGUtbGluayI+CiAgICAgICAgICAgICAgICAgICAgICAgIPCfkr4gJHtmaWxlTmFtZX0KICAgICAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgdWkuY2hhdC5hcHBlbmRDaGlsZChtc2dEaXYpOwogICAgICAgICAgICAgICAgdWkuY2hhdC5zY3JvbGxUb3AgPSB1aS5jaGF0LnNjcm9sbEhlaWdodDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU29uaWRvIGRlIGNvbmZpcm1hY2nDs24gbG9jYWwKICAgICAgICAgICAgY29uc3QgbyA9IGF1ZGlvQ3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTsKICAgICAgICAgICAgby5jb25uZWN0KGF1ZGlvQ3R4LmRlc3RpbmF0aW9uKTsKICAgICAgICAgICAgby5mcmVxdWVuY3kudmFsdWUgPSA2MDA7CiAgICAgICAgICAgIG8uc3RhcnQoKTsgby5zdG9wKGF1ZGlvQ3R4LmN1cnJlbnRUaW1lICsgMC4xKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApOwogICAgfQoKICAgIC8vIC0tLSBVVElMUyAtLS0KICAgIGZ1bmN0aW9uIGFkZE1zZyh0ZXh0LCB0eXBlKSB7CiAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgZGl2LmNsYXNzTmFtZSA9IGBtc2cgJHt0eXBlfWA7CiAgICAgICAgZGl2LmlubmVyVGV4dCA9IHRleHQ7CiAgICAgICAgdWkuY2hhdC5hcHBlbmRDaGlsZChkaXYpOwogICAgICAgIHVpLmNoYXQuc2Nyb2xsVG9wID0gdWkuY2hhdC5zY3JvbGxIZWlnaHQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkZFN5c3RlbU1zZyh0ZXh0KSB7CiAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgZGl2LmNsYXNzTmFtZSA9ICdtc2cgc3lzdGVtJzsKICAgICAgICBkaXYuaW5uZXJUZXh0ID0gdGV4dDsKICAgICAgICB1aS5jaGF0LmFwcGVuZENoaWxkKGRpdik7CiAgICAgICAgdWkuY2hhdC5zY3JvbGxUb3AgPSB1aS5jaGF0LnNjcm9sbEhlaWdodDsKICAgIH0KCjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4=
