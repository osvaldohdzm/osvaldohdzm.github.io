example 23

PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVzIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+U29uaWMgQ2hhdCDwn5SKPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICA6cm9vdCB7IC0tYmc6ICMwZjE3MmE7IC0tcGFuZWw6ICMxZTI5M2I7IC0tbWU6ICMzYjgyZjY7IC0tdGhlbTogIzMzNDE1NTsgLS10ZXh0OiAjZjFmNWY5OyB9CiAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICJTZWdvZSBVSSIsIFJvYm90bywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsgYmFja2dyb3VuZDogdmFyKC0tYmcpOyBjb2xvcjogdmFyKC0tdGV4dCk7IG1hcmdpbjogMDsgZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgaGVpZ2h0OiAxMDB2aDsgb3ZlcmZsb3c6IGhpZGRlbjsgfQogICAgICAgIAogICAgICAgIC8qIEhFQURFUiAqLwogICAgICAgIGhlYWRlciB7IHBhZGRpbmc6IDE1cHg7IGJhY2tncm91bmQ6IHZhcigtLXBhbmVsKTsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMzMzM7IGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsgYm94LXNoYWRvdzogMCA0cHggMTBweCByZ2JhKDAsMCwwLDAuMyk7IH0KICAgICAgICBoMSB7IG1hcmdpbjogMDsgZm9udC1zaXplOiAxLjJyZW07IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTBweDsgfQogICAgICAgIC5zdGF0dXMtZG90IHsgd2lkdGg6IDEwcHg7IGhlaWdodDogMTBweDsgYmFja2dyb3VuZDogI2VmNDQ0NDsgYm9yZGVyLXJhZGl1czogNTAlOyBib3gtc2hhZG93OiAwIDAgNXB4ICNlZjQ0NDQ7IHRyYW5zaXRpb246IDAuM3M7IH0KICAgICAgICAuc3RhdHVzLWRvdC5hY3RpdmUgeyBiYWNrZ3JvdW5kOiAjMjJjNTVlOyBib3gtc2hhZG93OiAwIDAgOHB4ICMyMmM1NWU7IH0KICAgICAgICAKICAgICAgICAjYnRuQWN0aXZhdGUgeyBiYWNrZ3JvdW5kOiB2YXIoLS1tZSk7IGNvbG9yOiB3aGl0ZTsgYm9yZGVyOiBub25lOyBwYWRkaW5nOiA4cHggMTVweDsgYm9yZGVyLXJhZGl1czogMjBweDsgZm9udC13ZWlnaHQ6IGJvbGQ7IGN1cnNvcjogcG9pbnRlcjsgdHJhbnNpdGlvbjogMC4yczsgfQogICAgICAgICNidG5BY3RpdmF0ZTpkaXNhYmxlZCB7IG9wYWNpdHk6IDAuNTsgY3Vyc29yOiBkZWZhdWx0OyBiYWNrZ3JvdW5kOiAjNDQ0OyB9CgogICAgICAgIC8qIFZJU1VBTElaRVIgKi8KICAgICAgICBjYW52YXMgeyB3aWR0aDogMTAwJTsgaGVpZ2h0OiA2MHB4OyBiYWNrZ3JvdW5kOiAjMDAwOyBvcGFjaXR5OiAwLjU7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiA2MHB4OyBsZWZ0OiAwOyB6LWluZGV4OiAwOyBwb2ludGVyLWV2ZW50czogbm9uZTsgZGlzcGxheTogbm9uZTsgfQogICAgICAgIGJvZHkuY29ubmVjdGVkIGNhbnZhcyB7IGRpc3BsYXk6IGJsb2NrOyB9CgogICAgICAgIC8qIENIQVQgQVJFQSAqLwogICAgICAgICNjaGF0LXdpbmRvdyB7IGZsZXg6IDE7IG92ZXJmbG93LXk6IGF1dG87IHBhZGRpbmc6IDgwcHggMTVweCAyMHB4IDE1cHg7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGdhcDogMTBweDsgcG9zaXRpb246IHJlbGF0aXZlOyB6LWluZGV4OiAxOyB9CiAgICAgICAgCiAgICAgICAgLm1zZyB7IG1heC13aWR0aDogODAlOyBwYWRkaW5nOiAxMHB4IDE1cHg7IGJvcmRlci1yYWRpdXM6IDEycHg7IGZvbnQtc2l6ZTogMC45NXJlbTsgbGluZS1oZWlnaHQ6IDEuNDsgd29yZC13cmFwOiBicmVhay13b3JkOyBwb3NpdGlvbjogcmVsYXRpdmU7IGFuaW1hdGlvbjogcG9wSW4gMC4zcyBlYXNlOyB9CiAgICAgICAgLm1zZy5zZW50IHsgYWxpZ24tc2VsZjogZmxleC1lbmQ7IGJhY2tncm91bmQ6IHZhcigtLW1lKTsgY29sb3I6IHdoaXRlOyBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMnB4OyB9CiAgICAgICAgLm1zZy5yZWNlaXZlZCB7IGFsaWduLXNlbGY6IGZsZXgtc3RhcnQ7IGJhY2tncm91bmQ6IHZhcigtLXRoZW0pOyBjb2xvcjogI2UyZThmMDsgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMnB4OyB9CiAgICAgICAgLm1zZy5zeXN0ZW0geyBhbGlnbi1zZWxmOiBjZW50ZXI7IGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4xKTsgZm9udC1zaXplOiAwLjhyZW07IHBhZGRpbmc6IDVweCAxMnB4OyBib3JkZXItcmFkaXVzOiAyMHB4OyBjb2xvcjogIzk0YTNiODsgfQogICAgICAgIAogICAgICAgIC5maWxlLWF0dGFjaG1lbnQgeyBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMik7IHBhZGRpbmc6IDhweDsgbWFyZ2luLXRvcDogNXB4OyBib3JkZXItcmFkaXVzOiA2cHg7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTBweDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBjb2xvcjogd2hpdGU7IGZvbnQtc2l6ZTogMC44NXJlbTsgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjEpOyB9CiAgICAgICAgLmZpbGUtYXR0YWNobWVudDpob3ZlciB7IGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4zKTsgfQoKICAgICAgICAvKiBJTlBVVCBBUkVBICovCiAgICAgICAgZm9vdGVyIHsgcGFkZGluZzogMTVweDsgYmFja2dyb3VuZDogdmFyKC0tcGFuZWwpOyBib3JkZXItdG9wOiAxcHggc29saWQgIzMzMzsgZGlzcGxheTogZmxleDsgZ2FwOiAxMHB4OyBhbGlnbi1pdGVtczogY2VudGVyOyB6LWluZGV4OiAyOyB9CiAgICAgICAgaW5wdXRbdHlwZT0idGV4dCJdIHsgZmxleDogMTsgcGFkZGluZzogMTJweDsgYm9yZGVyLXJhZGl1czogMjBweDsgYm9yZGVyOiAxcHggc29saWQgIzQ3NTU2OTsgYmFja2dyb3VuZDogIzBmMTcyYTsgY29sb3I6IHdoaXRlOyBvdXRsaW5lOiBub25lOyB9CiAgICAgICAgaW5wdXRbdHlwZT0iZmlsZSJdIHsgZGlzcGxheTogbm9uZTsgfQogICAgICAgIC5pY29uLWJ0biB7IGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OyBib3JkZXI6IG5vbmU7IGNvbG9yOiAjOTRhM2I4OyBjdXJzb3I6IHBvaW50ZXI7IHBhZGRpbmc6IDhweDsgYm9yZGVyLXJhZGl1czogNTAlOyB0cmFuc2l0aW9uOiAwLjJzOyB9CiAgICAgICAgLmljb24tYnRuOmhvdmVyIHsgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjEpOyBjb2xvcjogd2hpdGU7IH0KICAgICAgICAjYnRuU2VuZCB7IGJhY2tncm91bmQ6IHZhcigtLW1lKTsgY29sb3I6IHdoaXRlOyBib3JkZXItcmFkaXVzOiA1MCU7IHdpZHRoOiA0MHB4OyBoZWlnaHQ6IDQwcHg7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBmbGV4LXNocmluazogMDsgfQogICAgICAgIAogICAgICAgIEBrZXlmcmFtZXMgcG9wSW4geyBmcm9tIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjkpOyBvcGFjaXR5OiAwOyB9IHRvIHsgdHJhbnNmb3JtOiBzY2FsZSgxKTsgb3BhY2l0eTogMTsgfSB9CiAgICAgICAgCiAgICAgICAgLyogUFJPR1JFU1MgQkFSIGluc2lkZSBjaGF0ICovCiAgICAgICAgLnByb2dyZXNzLWNvbnRhaW5lciB7IGhlaWdodDogNHB4OyBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMyk7IG1hcmdpbi10b3A6IDhweDsgYm9yZGVyLXJhZGl1czogMnB4OyBvdmVyZmxvdzogaGlkZGVuOyBkaXNwbGF5OiBub25lOyB9CiAgICAgICAgLnByb2dyZXNzLWJhciB7IGhlaWdodDogMTAwJTsgYmFja2dyb3VuZDogIzRhZGU4MDsgd2lkdGg6IDAlOyB0cmFuc2l0aW9uOiB3aWR0aCAwLjFzOyB9CiAgICAgICAgLnJlY2VpdmluZyAucHJvZ3Jlc3MtY29udGFpbmVyIHsgZGlzcGxheTogYmxvY2s7IH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+Cgo8aGVhZGVyPgogICAgPGgxPjxkaXYgY2xhc3M9InN0YXR1cy1kb3QiIGlkPSJzdGF0dXNEb3QiPjwvZGl2PiBTb25pY0NoYXQ8L2gxPgogICAgPGJ1dHRvbiBpZD0iYnRuQWN0aXZhdGUiPvCflLUgQUNUSVZBUiBDSEFUPC9idXR0b24+CjwvaGVhZGVyPgoKPGNhbnZhcyBpZD0ic2NvcGUiPjwvY2FudmFzPgoKPGRpdiBpZD0iY2hhdC13aW5kb3ciPgogICAgPGRpdiBjbGFzcz0ibXNnIHN5c3RlbSI+QmllbnZlbmlkby4gQWN0aXZhIGVsIGNoYXQgcGFyYSBlbXBlemFyLjwvZGl2Pgo8L2Rpdj4KCjxmb290ZXI+CiAgICA8bGFiZWwgY2xhc3M9Imljb24tYnRuIiB0aXRsZT0iQWRqdW50YXIgQXJjaGl2byI+CiAgICAgICAg8J+TjiA8aW5wdXQgdHlwZT0iZmlsZSIgaWQ9ImZpbGVJbnB1dCI+CiAgICA8L2xhYmVsPgogICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJtc2dJbnB1dCIgcGxhY2Vob2xkZXI9IkVzY3JpYmUgdW4gbWVuc2FqZS4uLiIgZGlzYWJsZWQ+CiAgICA8YnV0dG9uIGlkPSJidG5TZW5kIiBjbGFzcz0iaWNvbi1idG4iIGRpc2FibGVkPuKepDwvYnV0dG9uPgo8L2Zvb3Rlcj4KCjxzY3JpcHQ+CiAgICAvLyAtLS0gQ09ORklHVVJBQ0nDk04gREVMIFBST1RPQ09MTyAoRXN0YWJpbGlkYWQgdnMgVmVsb2NpZGFkKSAtLS0KICAgIGNvbnN0IENPTkZJRyA9IHsKICAgICAgICBiYXVkUmF0ZTogNDAsICAgICAgLy8gVmVsb2NpZGFkIGRlIHRyYW5zbWlzacOzbiAoQml0cy9zZWd1bmRvKS4gCiAgICAgICAgZnJlcUxvdzogMTgwMCwgICAgIC8vIEZyZWN1ZW5jaWEgcGFyYSBiaXQgMAogICAgICAgIGZyZXFIaWdoOiAyODAwLCAgICAvLyBGcmVjdWVuY2lhIHBhcmEgYml0IDEKICAgICAgICBzYW1wbGVSYXRlOiA0NDEwMAogICAgfTsKCiAgICAvLyAtLS0gVkFSSUFCTEVTIEdMT0JBTEVTIC0tLQogICAgbGV0IGF1ZGlvQ3R4ID0gbnVsbDsKICAgIGxldCBhbmFseXNlciA9IG51bGw7CiAgICBsZXQgaXNDb25uZWN0ZWQgPSBmYWxzZTsKICAgIGxldCBpc1RyYW5zbWl0dGluZyA9IGZhbHNlOwoKICAgIC8vIFVJIEVsZW1lbnRzCiAgICBjb25zdCBjaGF0V2luZG93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXQtd2luZG93Jyk7CiAgICBjb25zdCBtc2dJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtc2dJbnB1dCcpOwogICAgY29uc3QgYnRuU2VuZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5TZW5kJyk7CiAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0Jyk7CgogICAgLy8gLS0tIDEuIEFDVElWQUNJw5NOIERFTCBTSVNURU1BIC0tLQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bkFjdGl2YXRlJykub25jbGljayA9IGFzeW5jICgpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgICBhdWRpb0N0eCA9IG5ldyAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU29saWNpdGFyIG1pY3LDs2Zvbm8KICAgICAgICAgICAgY29uc3Qgc3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoeyAKICAgICAgICAgICAgICAgIGF1ZGlvOiB7IAogICAgICAgICAgICAgICAgICAgIGVjaG9DYW5jZWxsYXRpb246IGZhbHNlLCAKICAgICAgICAgICAgICAgICAgICBub2lzZVN1cHByZXNzaW9uOiBmYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgYXV0b0dhaW5Db250cm9sOiBmYWxzZSAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gQ29uZmlndXJhciBBbmFsaXphZG9yIChSZWNlcHRvcikKICAgICAgICAgICAgY29uc3Qgc291cmNlID0gYXVkaW9DdHguY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2Uoc3RyZWFtKTsKICAgICAgICAgICAgYW5hbHlzZXIgPSBhdWRpb0N0eC5jcmVhdGVBbmFseXNlcigpOwogICAgICAgICAgICBhbmFseXNlci5mZnRTaXplID0gMTAyNDsKICAgICAgICAgICAgYW5hbHlzZXIuc21vb3RoaW5nVGltZUNvbnN0YW50ID0gMC4xOwogICAgICAgICAgICBzb3VyY2UuY29ubmVjdChhbmFseXNlcik7CgogICAgICAgICAgICAvLyBVSSBVcGRhdGVzCiAgICAgICAgICAgIGlzQ29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdjb25uZWN0ZWQnKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXR1c0RvdCcpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuQWN0aXZhdGUnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBtc2dJbnB1dC5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICBidG5TZW5kLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgIAogICAgICAgICAgICBzdGFydFZpc3VhbGl6ZXIoKTsKICAgICAgICAgICAgc3RhcnRMaXN0ZW5pbmdMb29wKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBhZGRTeXN0ZW1Nc2coIvCflIogQXVkaW8gY29uZWN0YWRvLiBFc2N1Y2hhbmRvIHNlw7FhbGVzLi4uIik7CgogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgYWxlcnQoIkVycm9yOiBOZWNlc2l0YXMgbWljcsOzZm9ubyBwYXJhIHVzYXIgU29uaWNDaGF0LiIpOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIH0KICAgIH07CgogICAgLy8gLS0tIDIuIFRSQU5TTUlTScOTTiAoVFgpIC0tLQogICAgCiAgICAvLyBFbnZpYXIgVGV4dG8KICAgIGJ0blNlbmQub25jbGljayA9ICgpID0+IHsKICAgICAgICBjb25zdCB0ZXh0ID0gbXNnSW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgIGlmICghdGV4dCkgcmV0dXJuOwogICAgICAgIAogICAgICAgIC8vIEFncmVnYXIgYSBVSQogICAgICAgIGFkZE1lc3NhZ2UodGV4dCwgJ3NlbnQnKTsKICAgICAgICBtc2dJbnB1dC52YWx1ZSA9ICIiOwogICAgICAgIAogICAgICAgIC8vIEVtcGFxdWV0YXI6IFtUWVBFPTFdIFtURVhUT10KICAgICAgICBjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7CiAgICAgICAgY29uc3QgcGF5bG9hZCA9IGVuY29kZXIuZW5jb2RlKHRleHQpOwogICAgICAgIHRyYW5zbWl0UGFja2V0KDEsIHBheWxvYWQpOyAvLyBUaXBvIDEgPSBUZXh0bwogICAgfTsKCiAgICAvLyBFbnZpYXIgQXJjaGl2bwogICAgZmlsZUlucHV0Lm9uY2hhbmdlID0gYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IGZpbGUgPSBmaWxlSW5wdXQuZmlsZXNbMF07CiAgICAgICAgaWYgKCFmaWxlKSByZXR1cm47CgogICAgICAgIC8vIExpbWl0ZSBkZSBzZWd1cmlkYWQKICAgICAgICBpZiAoZmlsZS5zaXplID4gNTAwICogMTAyNCkgeyAvLyA1MDBLQiBhdmlzbwogICAgICAgICAgICBpZighY29uZmlybSgiQXJjaGl2b3MgZ3JhbmRlcyB0YXJkYXLDoW4gbXVjaG8gcG9yIGF1ZGlvLiDCv0Vudmlhcj8iKSkgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgYWRkTWVzc2FnZShgRW52aWFuZG8gYXJjaGl2bzogJHtmaWxlLm5hbWV9Li4uYCwgJ3NlbnQnKTsKICAgICAgICAKICAgICAgICAvLyBFbXBhcXVldGFyOiBbVFlQRT0yXSBbTk9NQlJFX0xFTl0gW05PTUJSRV0gW0RBVEFdCiAgICAgICAgY29uc3QgbmFtZUJ5dGVzID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGZpbGUubmFtZSk7CiAgICAgICAgY29uc3QgZmlsZUJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpKTsKICAgICAgICAKICAgICAgICAvLyBDb25zdHJ1aXIgcGF5bG9hZCBjb21wbGVqbzogW0xlbk5vbWJyZSAoMSBieXRlKV0gKyBbTm9tYnJlXSArIFtDb250ZW5pZG9dCiAgICAgICAgY29uc3QgcGF5bG9hZCA9IG5ldyBVaW50OEFycmF5KDEgKyBuYW1lQnl0ZXMubGVuZ3RoICsgZmlsZUJ5dGVzLmxlbmd0aCk7CiAgICAgICAgcGF5bG9hZFswXSA9IG5hbWVCeXRlcy5sZW5ndGg7CiAgICAgICAgcGF5bG9hZC5zZXQobmFtZUJ5dGVzLCAxKTsKICAgICAgICBwYXlsb2FkLnNldChmaWxlQnl0ZXMsIDEgKyBuYW1lQnl0ZXMubGVuZ3RoKTsKCiAgICAgICAgdHJhbnNtaXRQYWNrZXQoMiwgcGF5bG9hZCk7IC8vIFRpcG8gMiA9IEFyY2hpdm8KICAgICAgICBmaWxlSW5wdXQudmFsdWUgPSAiIjsgLy8gUmVzZXQKICAgIH07CgogICAgLy8gTsO6Y2xlbyBkZSBUcmFuc21pc2nDs24gKE1vZHVsYWNpw7NuIEZTSyBjb24gVUFSVCkKICAgIGFzeW5jIGZ1bmN0aW9uIHRyYW5zbWl0UGFja2V0KHR5cGUsIHBheWxvYWREYXRhKSB7CiAgICAgICAgaWYgKGlzVHJhbnNtaXR0aW5nKSByZXR1cm47CiAgICAgICAgaXNUcmFuc21pdHRpbmcgPSB0cnVlOwogICAgICAgIG1zZ0lucHV0LmRpc2FibGVkID0gdHJ1ZTsKCiAgICAgICAgLy8gRVNUUlVDVFVSQSBERUwgUEFRVUVURToKICAgICAgICAvLyBbU1lOQyAweEFBXSBbVFlQRV0gW0xFTiAoMiBieXRlcyldIFtQQVlMT0FEXSBbQ0hFQ0tTVU0gKHNpbXBsZSBYT1IpXQogICAgICAgIGNvbnN0IGxlbiA9IHBheWxvYWREYXRhLmxlbmd0aDsKICAgICAgICBjb25zdCBoZWFkZXIgPSBuZXcgVWludDhBcnJheShbCiAgICAgICAgICAgIDB4QUEsICAgICAgICAgICAvLyBTaW5jcm9uaXphY2nDs24gKDEwMTAxMDEwKQogICAgICAgICAgICB0eXBlLCAgICAgICAgICAgLy8gMT1UZXh0bywgMj1BcmNoaXZvCiAgICAgICAgICAgIChsZW4gPj4gOCkgJiAweEZGLCAvLyBMZW5ndGggSGlnaCBCeXRlCiAgICAgICAgICAgIGxlbiAmIDB4RkYgICAgICAvLyBMZW5ndGggTG93IEJ5dGUKICAgICAgICBdKTsKCiAgICAgICAgY29uc3QgZnVsbFBhY2tldCA9IG5ldyBVaW50OEFycmF5KGhlYWRlci5sZW5ndGggKyBwYXlsb2FkRGF0YS5sZW5ndGgpOwogICAgICAgIGZ1bGxQYWNrZXQuc2V0KGhlYWRlcik7CiAgICAgICAgZnVsbFBhY2tldC5zZXQocGF5bG9hZERhdGEsIGhlYWRlci5sZW5ndGgpOwoKICAgICAgICAvLyBHZW5lcmFyIEF1ZGlvCiAgICAgICAgY29uc3Qgb3NjID0gYXVkaW9DdHguY3JlYXRlT3NjaWxsYXRvcigpOwogICAgICAgIGNvbnN0IGdhaW4gPSBhdWRpb0N0eC5jcmVhdGVHYWluKCk7CiAgICAgICAgb3NjLmNvbm5lY3QoZ2Fpbik7CiAgICAgICAgZ2Fpbi5jb25uZWN0KGF1ZGlvQ3R4LmRlc3RpbmF0aW9uKTsKICAgICAgICBvc2Muc3RhcnQoKTsKCiAgICAgICAgY29uc3QgYml0VGltZSA9IDEgLyBDT05GSUcuYmF1ZFJhdGU7CiAgICAgICAgbGV0IHN0YXJ0VGltZSA9IGF1ZGlvQ3R4LmN1cnJlbnRUaW1lICsgMC4xOwoKICAgICAgICAvLyBUb25vICJXYWtlIFVwIiAoUG9ydGFkb3JhIEFsdGEpCiAgICAgICAgb3NjLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZShDT05GSUcuZnJlcUhpZ2gsIHN0YXJ0VGltZSAtIDAuNSk7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZnVsbFBhY2tldC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdCBieXRlID0gZnVsbFBhY2tldFtpXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNUQVJUIEJJVCAoTG93KQogICAgICAgICAgICBvc2MuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKENPTkZJRy5mcmVxTG93LCBzdGFydFRpbWUpOwogICAgICAgICAgICBzdGFydFRpbWUgKz0gYml0VGltZTsKCiAgICAgICAgICAgIC8vIERBVE9TICg4IGJpdHMsIExTQiBmaXJzdCkKICAgICAgICAgICAgZm9yIChsZXQgYiA9IDA7IGIgPCA4OyBiKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJpdCA9IChieXRlID4+IGIpICYgMTsKICAgICAgICAgICAgICAgIG9zYy5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoYml0ID8gQ09ORklHLmZyZXFIaWdoIDogQ09ORklHLmZyZXFMb3csIHN0YXJ0VGltZSk7CiAgICAgICAgICAgICAgICBzdGFydFRpbWUgKz0gYml0VGltZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU1RPUCBCSVQgKEhpZ2gpCiAgICAgICAgICAgIG9zYy5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoQ09ORklHLmZyZXFIaWdoLCBzdGFydFRpbWUpOwogICAgICAgICAgICBzdGFydFRpbWUgKz0gYml0VGltZTsKICAgICAgICB9CgogICAgICAgIG9zYy5zdG9wKHN0YXJ0VGltZSk7CiAgICAgICAgCiAgICAgICAgLy8gRXNwZXJhciBhIHF1ZSB0ZXJtaW5lIHBhcmEgbGliZXJhciBVSQogICAgICAgIGNvbnN0IGR1cmF0aW9uID0gKHN0YXJ0VGltZSAtIGF1ZGlvQ3R4LmN1cnJlbnRUaW1lKSAqIDEwMDA7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIGlzVHJhbnNtaXR0aW5nID0gZmFsc2U7CiAgICAgICAgICAgIG1zZ0lucHV0LmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgIG1zZ0lucHV0LmZvY3VzKCk7CiAgICAgICAgfSwgZHVyYXRpb24gKyAyMDApOwogICAgfQoKCiAgICAvLyAtLS0gMy4gUkVDRVBDScOTTiAoUlgpIC0tLQogICAgLy8gTcOhcXVpbmEgZGUgZXN0YWRvcyBwYXJhIGxlZXIgZWwgc3RyZWFtIGRlIGF1ZGlvCiAgICAKICAgIGxldCByeFN0YXRlID0gJ0lETEUnOyAvLyBJRExFLCBIRUFERVIsIFBBWUxPQUQKICAgIGxldCByeEJ1ZmZlciA9IFtdOyAgICAvLyBCdWZmZXIgdGVtcG9yYWwgZGUgYnl0ZXMKICAgIGxldCByeFRhcmdldExlbiA9IDA7ICAvLyBMb25naXR1ZCBlc3BlcmFkYQogICAgbGV0IHJ4VHlwZSA9IDA7ICAgICAgIC8vIFRpcG8gZGUgbWVuc2FqZQogICAgbGV0IHJ4VUlCdWJibGUgPSBudWxsOyAvLyBSZWZlcmVuY2lhIGEgbGEgYnVyYnVqYSBkZSBjaGF0IGFjdHVhbAoKICAgIGZ1bmN0aW9uIHN0YXJ0TGlzdGVuaW5nTG9vcCgpIHsKICAgICAgICBjb25zdCBkYXRhQXJyYXkgPSBuZXcgVWludDhBcnJheShhbmFseXNlci5mcmVxdWVuY3lCaW5Db3VudCk7CiAgICAgICAgY29uc3QgYml0VGltZU1zID0gMTAwMCAvIENPTkZJRy5iYXVkUmF0ZTsKICAgICAgICAKICAgICAgICBsZXQgaW5CeXRlID0gZmFsc2U7CiAgICAgICAgbGV0IGJpdEluZGV4ID0gMDsKICAgICAgICBsZXQgY3VycmVudEJ5dGUgPSAwOwogICAgICAgIGxldCBsYXN0U2FtcGxlID0gMDsKCiAgICAgICAgLy8gTG9vcCBkZSBhbHRhIHByZWNpc2nDs24gKHJlcXVlc3RBbmltYXRpb25GcmFtZSkKICAgICAgICBjb25zdCBsb29wID0gKHRpbWVzdGFtcCkgPT4gewogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7CiAgICAgICAgICAgIGlmIChpc1RyYW5zbWl0dGluZykgcmV0dXJuOyAvLyBObyBlc2N1Y2hhcm5vcyBhIG5vc290cm9zIG1pc21vcwoKICAgICAgICAgICAgLy8gQ29udHJvbCBkZSB0aWVtcG8gKFNhbXBsaW5nIHJhdGUgc29mdHdhcmUpCiAgICAgICAgICAgIGlmICh0aW1lc3RhbXAgLSBsYXN0U2FtcGxlIDwgYml0VGltZU1zKSByZXR1cm47IC8vIEVzcGVyYXIgYWwgY2VudHJvIGRlbCBiaXQKICAgICAgICAgICAgCiAgICAgICAgICAgIGFuYWx5c2VyLmdldEJ5dGVGcmVxdWVuY3lEYXRhKGRhdGFBcnJheSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEZXRlY3RhciBGcmVjdWVuY2lhIERvbWluYW50ZQogICAgICAgICAgICBsZXQgbWF4VmFsID0gMCwgbWF4SWR4ID0gMDsKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8ZGF0YUFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZihkYXRhQXJyYXlbaV0gPiBtYXhWYWwpIHsgbWF4VmFsID0gZGF0YUFycmF5W2ldOyBtYXhJZHggPSBpOyB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZnJlcSA9IG1heElkeCAqIENPTkZJRy5zYW1wbGVSYXRlIC8gYW5hbHlzZXIuZmZ0U2l6ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEzDs2dpY2EgQmluYXJpYSAoU2NobWl0dCBUcmlnZ2VyKQogICAgICAgICAgICBsZXQgYml0ID0gLTE7CiAgICAgICAgICAgIGlmIChtYXhWYWwgPiA1MCkgeyAvLyBVbWJyYWwgZGUgcnVpZG8KICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhmcmVxIC0gQ09ORklHLmZyZXFMb3cpIDwgMjAwKSBiaXQgPSAwOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoTWF0aC5hYnMoZnJlcSAtIENPTkZJRy5mcmVxSGlnaCkgPCAyMDApIGJpdCA9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE3DoXF1aW5hIFVBUlQgKEJ5dGUgYXNzZW1ibGVyKQogICAgICAgICAgICBpZiAoIWluQnl0ZSkgewogICAgICAgICAgICAgICAgaWYgKGJpdCA9PT0gMCkgeyAvLyBTVEFSVCBCSVQgZGV0ZWN0YWRvCiAgICAgICAgICAgICAgICAgICAgaW5CeXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBiaXRJbmRleCA9IDA7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwogICAgICAgICAgICAgICAgICAgIC8vIEFqdXN0YXIgZmFzZTogc2FsdGFyIG1lZGlvIGJpdCBleHRyYSBwYXJhIG11ZXN0cmVhciBlbiBlbCBjZW50cm8gbGEgcHLDs3hpbWEgdmV6CiAgICAgICAgICAgICAgICAgICAgbGFzdFNhbXBsZSA9IHRpbWVzdGFtcCArIChiaXRUaW1lTXMgKiAwLjUpOyAKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBMZXllbmRvIGJpdHMgZGUgZGF0b3MKICAgICAgICAgICAgICAgIGlmIChiaXRJbmRleCA8IDgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYml0ID09PSAxKSBjdXJyZW50Qnl0ZSB8PSAoMSA8PCBiaXRJbmRleCk7IC8vIExTQiBGaXJzdAogICAgICAgICAgICAgICAgICAgIGJpdEluZGV4Kys7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIFNUT1AgQklUIChiaXRJbmRleCA9PSA4KSAtPiBGaW4gZGVsIGJ5dGUKICAgICAgICAgICAgICAgICAgICBpbkJ5dGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzUnhCeXRlKGN1cnJlbnRCeXRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBsYXN0U2FtcGxlID0gdGltZXN0YW1wOwogICAgICAgIH07CiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApOwogICAgfQoKICAgIC8vIFByb2Nlc2FyIEJ5dGVzIHJlY2liaWRvcyBzZWfDum4gcHJvdG9jb2xvCiAgICBmdW5jdGlvbiBwcm9jZXNzUnhCeXRlKGJ5dGUpIHsKICAgICAgICAvLyBFc3RhZG8gMDogQnVzY2FuZG8gU1lOQyAoMHhBQSkKICAgICAgICBpZiAocnhTdGF0ZSA9PT0gJ0lETEUnKSB7CiAgICAgICAgICAgIGlmIChieXRlID09PSAweEFBKSB7CiAgICAgICAgICAgICAgICByeFN0YXRlID0gJ1RZUEUnOwogICAgICAgICAgICAgICAgcnhCdWZmZXIgPSBbXTsKICAgICAgICAgICAgICAgIC8vIENyZWFyIGJ1cmJ1amEgdmlzdWFsIGRlICJSZWNpYmllbmRvLi4uIgogICAgICAgICAgICAgICAgcnhVSUJ1YmJsZSA9IGFkZE1lc3NhZ2UoIi4uLiIsICdyZWNlaXZlZCByZWNlaXZpbmcnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBFc3RhZG8gMTogVGlwbyBkZSBtZW5zYWplCiAgICAgICAgZWxzZSBpZiAocnhTdGF0ZSA9PT0gJ1RZUEUnKSB7CiAgICAgICAgICAgIHJ4VHlwZSA9IGJ5dGU7CiAgICAgICAgICAgIHJ4U3RhdGUgPSAnTEVOX0hJJzsKICAgICAgICB9CiAgICAgICAgLy8gRXN0YWRvIDI6IExvbmdpdHVkIChQYXJ0ZSBBbHRhKQogICAgICAgIGVsc2UgaWYgKHJ4U3RhdGUgPT09ICdMRU5fSEknKSB7CiAgICAgICAgICAgIHJ4VGFyZ2V0TGVuID0gYnl0ZSA8PCA4OwogICAgICAgICAgICByeFN0YXRlID0gJ0xFTl9MTyc7CiAgICAgICAgfQogICAgICAgIC8vIEVzdGFkbyAzOiBMb25naXR1ZCAoUGFydGUgQmFqYSkKICAgICAgICBlbHNlIGlmIChyeFN0YXRlID09PSAnTEVOX0xPJykgewogICAgICAgICAgICByeFRhcmdldExlbiB8PSBieXRlOwogICAgICAgICAgICByeFN0YXRlID0gJ1BBWUxPQUQnOwogICAgICAgICAgICB1cGRhdGVQcm9ncmVzcygwKTsgLy8gSW5pY2lhciBiYXJyYQogICAgICAgIH0KICAgICAgICAvLyBFc3RhZG8gNDogTGV5ZW5kbyBEYXRvcwogICAgICAgIGVsc2UgaWYgKHJ4U3RhdGUgPT09ICdQQVlMT0FEJykgewogICAgICAgICAgICByeEJ1ZmZlci5wdXNoKGJ5dGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQWN0dWFsaXphciBiYXJyYSBkZSBwcm9ncmVzbyB2aXN1YWwKICAgICAgICAgICAgaWYgKHJ4QnVmZmVyLmxlbmd0aCAlIDUgPT09IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBjdCA9IChyeEJ1ZmZlci5sZW5ndGggLyByeFRhcmdldExlbikgKiAxMDA7CiAgICAgICAgICAgICAgICB1cGRhdGVQcm9ncmVzcyhwY3QpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocnhCdWZmZXIubGVuZ3RoID49IHJ4VGFyZ2V0TGVuKSB7CiAgICAgICAgICAgICAgICBmaW5pc2hSZWNlcHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBmaW5pc2hSZWNlcHRpb24oKSB7CiAgICAgICAgcnhTdGF0ZSA9ICdJRExFJzsKICAgICAgICBpZiAoIXJ4VUlCdWJibGUpIHJldHVybjsKCiAgICAgICAgLy8gTGltcGlhciBpbmRpY2Fkb3JlcyBkZSBjYXJnYQogICAgICAgIHJ4VUlCdWJibGUuY2xhc3NMaXN0LnJlbW92ZSgncmVjZWl2aW5nJyk7CiAgICAgICAgY29uc3QgY29udGVudERpdiA9IHJ4VUlCdWJibGUucXVlcnlTZWxlY3RvcignLmNvbnRlbnQnKTsKICAgICAgICBjb25zdCBwcm9ncmVzc0RpdiA9IHJ4VUlCdWJibGUucXVlcnlTZWxlY3RvcignLnByb2dyZXNzLWNvbnRhaW5lcicpOwogICAgICAgIGlmKHByb2dyZXNzRGl2KSBwcm9ncmVzc0Rpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkocnhCdWZmZXIpOwoKICAgICAgICBpZiAocnhUeXBlID09PSAxKSB7IAogICAgICAgICAgICAvLyBURVhUTwogICAgICAgICAgICBjb25zdCB0ZXh0ID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGRhdGEpOwogICAgICAgICAgICBjb250ZW50RGl2LmlubmVyVGV4dCA9IHRleHQ7CiAgICAgICAgfSAKICAgICAgICBlbHNlIGlmIChyeFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgLy8gQVJDSElWTwogICAgICAgICAgICAvLyBEZXNlbXBhcXVldGFyOiBbTGVuTmFtZV0gW05hbWVdIFtGaWxlQ29udGVudF0KICAgICAgICAgICAgY29uc3QgbmFtZUxlbiA9IGRhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IG5hbWVCeXRlcyA9IGRhdGEuc2xpY2UoMSwgMSArIG5hbWVMZW4pOwogICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShuYW1lQnl0ZXMpOwogICAgICAgICAgICBjb25zdCBmaWxlRGF0YSA9IGRhdGEuc2xpY2UoMSArIG5hbWVMZW4pOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtmaWxlRGF0YV0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScgfSk7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb250ZW50RGl2LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXY+UmVjaWJpZG8gYXJjaGl2bzo8L2Rpdj4KICAgICAgICAgICAgICAgIDxhIGhyZWY9IiR7dXJsfSIgZG93bmxvYWQ9IiR7ZmlsZU5hbWV9IiBjbGFzcz0iZmlsZS1hdHRhY2htZW50Ij4KICAgICAgICAgICAgICAgICAgICDwn5OEIDxzdHJvbmc+JHtmaWxlTmFtZX08L3N0cm9uZz4gPGJyPgogICAgICAgICAgICAgICAgICAgIDxzbWFsbD4oJHsoZmlsZURhdGEubGVuZ3RoLzEwMjQpLnRvRml4ZWQoMSl9IEtCKTwvc21hbGw+CiAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgIGA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFNvbmlkaXRvIGRlIMOpeGl0bwogICAgICAgIHBsYXlCZWVwKCk7CiAgICB9CgogICAgLy8gLS0tIFVJIEhFTFBFUlMgLS0tCgogICAgZnVuY3Rpb24gYWRkTWVzc2FnZShjb250ZW50LCB0eXBlKSB7CiAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgZGl2LmNsYXNzTmFtZSA9IGBtc2cgJHt0eXBlfWA7CiAgICAgICAgZGl2LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudCI+JHtjb250ZW50fTwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9ncmVzcy1jb250YWluZXIiPjxkaXYgY2xhc3M9InByb2dyZXNzLWJhciI+PC9kaXY+PC9kaXY+CiAgICAgICAgYDsKICAgICAgICBjaGF0V2luZG93LmFwcGVuZENoaWxkKGRpdik7CiAgICAgICAgY2hhdFdpbmRvdy5zY3JvbGxUb3AgPSBjaGF0V2luZG93LnNjcm9sbEhlaWdodDsKICAgICAgICByZXR1cm4gZGl2OwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZFN5c3RlbU1zZyh0ZXh0KSB7CiAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgZGl2LmNsYXNzTmFtZSA9ICdtc2cgc3lzdGVtJzsKICAgICAgICBkaXYuaW5uZXJUZXh0ID0gdGV4dDsKICAgICAgICBjaGF0V2luZG93LmFwcGVuZENoaWxkKGRpdik7CiAgICAgICAgY2hhdFdpbmRvdy5zY3JvbGxUb3AgPSBjaGF0V2luZG93LnNjcm9sbEhlaWdodDsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVQcm9ncmVzcyhwY3QpIHsKICAgICAgICBpZiAocnhVSUJ1YmJsZSkgewogICAgICAgICAgICBjb25zdCBiYXIgPSByeFVJQnViYmxlLnF1ZXJ5U2VsZWN0b3IoJy5wcm9ncmVzcy1iYXInKTsKICAgICAgICAgICAgaWYoYmFyKSBiYXIuc3R5bGUud2lkdGggPSBwY3QgKyAiJSI7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBsYXlCZWVwKCkgewogICAgICAgIGNvbnN0IG8gPSBhdWRpb0N0eC5jcmVhdGVPc2NpbGxhdG9yKCk7CiAgICAgICAgY29uc3QgZyA9IGF1ZGlvQ3R4LmNyZWF0ZUdhaW4oKTsKICAgICAgICBvLmNvbm5lY3QoZyk7CiAgICAgICAgZy5jb25uZWN0KGF1ZGlvQ3R4LmRlc3RpbmF0aW9uKTsKICAgICAgICBvLmZyZXF1ZW5jeS52YWx1ZSA9IDgwMDsKICAgICAgICBnLmdhaW4udmFsdWUgPSAwLjE7CiAgICAgICAgby5zdGFydCgpOwogICAgICAgIG8uc3RvcChhdWRpb0N0eC5jdXJyZW50VGltZSArIDAuMSk7CiAgICB9CgogICAgLy8gVmlzdWFsaXphZG9yIGRlIGZvbmRvIChFc3TDqXRpY28pCiAgICBmdW5jdGlvbiBzdGFydFZpc3VhbGl6ZXIoKSB7CiAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Njb3BlJyk7CiAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KGFuYWx5c2VyLmZyZXF1ZW5jeUJpbkNvdW50KTsKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBkcmF3KCkgewogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhdyk7CiAgICAgICAgICAgIGFuYWx5c2VyLmdldEJ5dGVGcmVxdWVuY3lEYXRhKGRhdGEpOwogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzNiODJmNic7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBiYXJXID0gKGNhbnZhcy53aWR0aCAvIGRhdGEubGVuZ3RoKSAqIDIuNTsKICAgICAgICAgICAgbGV0IHggPSAwOwogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBoID0gKGRhdGFbaV0gLyAyNTUpICogY2FudmFzLmhlaWdodDsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCh4LCBjYW52YXMuaGVpZ2h0IC0gaCwgYmFyVywgaCk7CiAgICAgICAgICAgICAgICB4ICs9IGJhclcgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRyYXcoKTsKICAgIH0KCjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4=
