

example15


PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVzIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+QXVkaW8gTW9kZW0gUm9idXN0byArIENSQzMyPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICA6cm9vdCB7IC0tcDogIzJjM2U1MDsgLS1zOiAjMzQ5OGRiOyAtLWU6ICNlNzRjM2M7IC0tZzogIzI3YWU2MDsgfQogICAgICAgIGJvZHkgeyBmb250LWZhbWlseTogJ1NlZ29lIFVJJywgc2Fucy1zZXJpZjsgYmFja2dyb3VuZDogI2VjZjBmMTsgcGFkZGluZzogMjBweDsgZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsgfQogICAgICAgIC5jb25zb2xlIHsgYmFja2dyb3VuZDogIzAwMDsgY29sb3I6ICMwZjA7IHBhZGRpbmc6IDE1cHg7IGJvcmRlci1yYWRpdXM6IDVweDsgd2lkdGg6IDEwMCU7IG1heC13aWR0aDogNjAwcHg7IGhlaWdodDogMTUwcHg7IG92ZXJmbG93LXk6IGF1dG87IGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7IGZvbnQtc2l6ZTogMTJweDsgbWFyZ2luLXRvcDogMTBweDsgfQogICAgICAgIC5jYXJkIHsgYmFja2dyb3VuZDogd2hpdGU7IHBhZGRpbmc6IDIwcHg7IGJvcmRlci1yYWRpdXM6IDEwcHg7IGJveC1zaGFkb3c6IDAgNHB4IDE1cHggcmdiYSgwLDAsMCwwLjEpOyB3aWR0aDogMTAwJTsgbWF4LXdpZHRoOiA2MDBweDsgbWFyZ2luLWJvdHRvbTogMjBweDsgfQogICAgICAgIGgyIHsgY29sb3I6IHZhcigtLXApOyBtYXJnaW4tdG9wOiAwOyB9CiAgICAgICAgYnV0dG9uIHsgYmFja2dyb3VuZDogdmFyKC0tcyk7IGNvbG9yOiB3aGl0ZTsgYm9yZGVyOiBub25lOyBwYWRkaW5nOiAxMnB4IDIwcHg7IGJvcmRlci1yYWRpdXM6IDVweDsgY3Vyc29yOiBwb2ludGVyOyBmb250LXdlaWdodDogYm9sZDsgd2lkdGg6IDEwMCU7IG1hcmdpbi10b3A6IDEwcHg7IHRyYW5zaXRpb246IDAuMnM7IH0KICAgICAgICBidXR0b246aG92ZXIgeyBiYWNrZ3JvdW5kOiAjMjk4MGI5OyB9CiAgICAgICAgYnV0dG9uOmRpc2FibGVkIHsgYmFja2dyb3VuZDogIzk1YTVhNjsgY3Vyc29yOiBub3QtYWxsb3dlZDsgfQogICAgICAgIC5zdGF0dXMtYmFyIHsgaGVpZ2h0OiAxMHB4OyBiYWNrZ3JvdW5kOiAjZGRkOyBib3JkZXItcmFkaXVzOiA1cHg7IG1hcmdpbi10b3A6IDE1cHg7IG92ZXJmbG93OiBoaWRkZW47IH0KICAgICAgICAuZmlsbCB7IGhlaWdodDogMTAwJTsgYmFja2dyb3VuZDogdmFyKC0tZyk7IHdpZHRoOiAwJTsgdHJhbnNpdGlvbjogd2lkdGggMC4yczsgfQogICAgICAgIC5lcnJvciB7IGNvbG9yOiB2YXIoLS1lKTsgZm9udC13ZWlnaHQ6IGJvbGQ7IH0KICAgICAgICAuc3VjY2VzcyB7IGNvbG9yOiB2YXIoLS1nKTsgZm9udC13ZWlnaHQ6IGJvbGQ7IH0KICAgICAgICAKICAgICAgICAvKiBWaXN1YWxpemFkb3IgZGUgRnJlY3VlbmNpYSAqLwogICAgICAgIGNhbnZhcyB7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDYwcHg7IGJhY2tncm91bmQ6ICMyMjI7IG1hcmdpbi10b3A6IDEwcHg7IGJvcmRlci1yYWRpdXM6IDRweDsgfQogICAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KCjxkaXYgY2xhc3M9ImNhcmQiPgogICAgPGgyPvCfk6EgRW1pc29yIChUeCk8L2gyPgogICAgPGlucHV0IHR5cGU9ImZpbGUiIGlkPSJmaWxlSW5wdXQiPgogICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4OyBmb250LXNpemU6IDAuOWVtOyBjb2xvcjogIzY2NjsiPgogICAgICAgIENvbmZpZ3VyYWNpw7NuOiA8c3BhbiBpZD0iZmlsZUluZm8iPk5pbmfDum4gYXJjaGl2byBzZWxlY2Npb25hZG88L3NwYW4+CiAgICA8L2Rpdj4KICAgIDxidXR0b24gaWQ9ImJ0blNlbmQiPjEuIENhbGN1bGFyIENSQyB5IFRyYW5zbWl0aXI8L2J1dHRvbj4KPC9kaXY+Cgo8ZGl2IGNsYXNzPSJjYXJkIj4KICAgIDxoMj7wn46nIFJlY2VwdG9yIChSeCk8L2gyPgogICAgPHAgc3R5bGU9ImZvbnQtc2l6ZTogMC45ZW07Ij5Bc2Vnw7pyYXRlIGRlIGVzdGFyIGVuIHVuIGx1Z2FyIHNpbGVuY2lvc28uPC9wPgogICAgPGJ1dHRvbiBpZD0iYnRuTGlzdGVuIj4yLiBBY3RpdmFyIEVzY3VjaGE8L2J1dHRvbj4KICAgIDxjYW52YXMgaWQ9InZpc3VhbGl6ZXIiPjwvY2FudmFzPgogICAgPGRpdiBjbGFzcz0ic3RhdHVzLWJhciI+PGRpdiBjbGFzcz0iZmlsbCIgaWQ9InByb2dyZXNzRmlsbCI+PC9kaXY+PC9kaXY+CiAgICA8ZGl2IGlkPSJyeFJlc3VsdCIgc3R5bGU9Im1hcmdpbi10b3A6IDEwcHg7Ij48L2Rpdj4KPC9kaXY+Cgo8ZGl2IGNsYXNzPSJjb25zb2xlIiBpZD0iY29uc29sZUxvZyI+CiAgICA+IFNpc3RlbWEgbGlzdG8uIENSQzMyIEVuZ2luZSBjYXJnYWRvLgo8L2Rpdj4KCjxzY3JpcHQ+CiAgICAvLyAtLS0gQ09ORklHVVJBQ0nDk04gREVMIFBST1RPQ09MTyAtLS0KICAgIGNvbnN0IENPTkZJRyA9IHsKICAgICAgICBmcmVxMDogMTUwMCwgICAgICAvLyBIeiBwYXJhIGJpbmFyaW8gMAogICAgICAgIGZyZXExOiAyNTAwLCAgICAgIC8vIEh6IHBhcmEgYmluYXJpbyAxCiAgICAgICAgYmF1ZFJhdGU6IDE1LCAgICAgLy8gQml0cyBwb3Igc2VndW5kbyAoQmFqYXIgcGFyYSBtw6FzIGZpYWJpbGlkYWQsIHN1YmlyIHBhcmEgdmVsb2NpZGFkKQogICAgICAgIHN0YXJ0U2VxOiAiMTAxMDEwMTAxMTExMDAwMCIsIC8vIFNlY3VlbmNpYSBkZSBzaW5jcm9uaXphY2nDs24gKFByZWFtYmxlKQogICAgfTsKCiAgICBjb25zdCBsb2cgPSAobXNnKSA9PiB7CiAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25zb2xlTG9nJyk7CiAgICAgICAgYy5pbm5lckhUTUwgKz0gYD4gJHttc2d9PGJyPmA7CiAgICAgICAgYy5zY3JvbGxUb3AgPSBjLnNjcm9sbEhlaWdodDsKICAgIH07CgogICAgLy8gLS0tIFVUSUxJREFERVMgQ1JJUFRPR1LDgUZJQ0FTIChDUkMzMikgLS0tCiAgICBjb25zdCBjcmMzMiA9IChmdW5jdGlvbigpIHsKICAgICAgICBsZXQgdGFibGUgPSBuZXcgVWludDMyQXJyYXkoMjU2KTsKICAgICAgICBmb3IobGV0IGk9MDsgaTwyNTY7IGkrKykgewogICAgICAgICAgICBsZXQgYyA9IGk7CiAgICAgICAgICAgIGZvcihsZXQgaz0wOyBrPDg7IGsrKykgYyA9ICgoYyYxKSA/ICgweEVEQjg4MzIwIF4gKGMgPj4+IDEpKSA6IChjID4+PiAxKSk7CiAgICAgICAgICAgIHRhYmxlW2ldID0gYzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHN0cikgewogICAgICAgICAgICBsZXQgY3JjID0gMCBeICgtMSk7CiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPHN0ci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY3JjID0gKGNyYyA+Pj4gOCkgXiB0YWJsZVsoY3JjIF4gc3RyLmNoYXJDb2RlQXQoaSkpICYgMHhGRl07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChjcmMgXiAoLTEpKSA+Pj4gMDsKICAgICAgICB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQ09OVkVSU09SRVMgLS0tCiAgICBjb25zdCBmaWxlVG9CYXNlNjQgPSAoZmlsZSkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdCk7IC8vIEluY2x1eWUgbWV0YWRhdGEgbWltZQogICAgICAgIHJlYWRlci5vbmVycm9yID0gZXJyb3IgPT4gcmVqZWN0KGVycm9yKTsKICAgIH0pOwoKICAgIGNvbnN0IHRleHRUb0JpdHMgPSAodGV4dCkgPT4gewogICAgICAgIGxldCBiaXRzID0gIiI7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZXh0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGJpdHMgKz0gdGV4dC5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDIpLnBhZFN0YXJ0KDgsICcwJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBiaXRzOwogICAgfTsKCiAgICBjb25zdCBiaXRzVG9UZXh0ID0gKGJpdHMpID0+IHsKICAgICAgICBsZXQgdGV4dCA9ICIiOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYml0cy5sZW5ndGg7IGkgKz0gOCkgewogICAgICAgICAgICB0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUocGFyc2VJbnQoYml0cy5zdWJzdHIoaSwgOCksIDIpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICB9OwoKICAgIC8vIC0tLSBMw5NHSUNBIERFTCBFTUlTT1IgLS0tCiAgICBsZXQgYXVkaW9DdHggPSBudWxsOwoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5TZW5kJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgY29uc3QgZmlsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpOwogICAgICAgIGlmKCFmaWxlSW5wdXQuZmlsZXMubGVuZ3RoKSByZXR1cm4gYWxlcnQoIlNlbGVjY2lvbmEgdW4gYXJjaGl2byIpOwogICAgICAgIAogICAgICAgIGNvbnN0IGZpbGUgPSBmaWxlSW5wdXQuZmlsZXNbMF07CiAgICAgICAgaWYoZmlsZS5zaXplID4gNTAwMCkgcmV0dXJuIGFsZXJ0KCJQb3IgZXN0YWJpbGlkYWQgZGUgYXVkaW8sIHVzYSBhcmNoaXZvcyA8IDVLQiBwYXJhIGVzdGEgZGVtby4iKTsKCiAgICAgICAgYXVkaW9DdHggPSBuZXcgKHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dCkoKTsKICAgICAgICAKICAgICAgICBsb2coIkxleWVuZG8gYXJjaGl2byB5IGNvbnZpcnRpZW5kbyBhIEJhc2U2NC4uLiIpOwogICAgICAgIGNvbnN0IGJhc2U2NERhdGEgPSBhd2FpdCBmaWxlVG9CYXNlNjQoZmlsZSk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXIgQ1JDIGFudGVzIGRlIGVudmlhcgogICAgICAgIGNvbnN0IGNoZWNrc3VtID0gY3JjMzIoYmFzZTY0RGF0YSk7CiAgICAgICAgbG9nKGBDUkMzMiBDYWxjdWxhZG86ICR7Y2hlY2tzdW0udG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCl9YCk7CiAgICAgICAgCiAgICAgICAgLy8gRW1wYXF1ZXRhcjogW0RBVEFdfFtDUkNdCiAgICAgICAgLy8gVXNhbW9zIHVuIHNlcGFyYWRvciBwaXBlICd8JyBwYXJhIGRpdmlkaXIgZGF0b3MgZGUgY2hlY2tzdW0KICAgICAgICBjb25zdCBwYXlsb2FkID0gYmFzZTY0RGF0YSArICJ8IiArIGNoZWNrc3VtLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpICsgInxFTkQiOwogICAgICAgIAogICAgICAgIGxvZygiR2VuZXJhbmRvIGZsdWpvIGRlIGJpdHMuLi4iKTsKICAgICAgICBjb25zdCBiaXRzID0gQ09ORklHLnN0YXJ0U2VxICsgdGV4dFRvQml0cyhwYXlsb2FkKTsKICAgICAgICAKICAgICAgICBsb2coYFRyYW5zbWl0aWVuZG8gJHtiaXRzLmxlbmd0aH0gYml0cy4gRHVyYWNpw7NuIGVzdDogJHsoYml0cy5sZW5ndGgvQ09ORklHLmJhdWRSYXRlKS50b0ZpeGVkKDEpfXNgKTsKICAgICAgICAKICAgICAgICBsZXQgb3NjID0gYXVkaW9DdHguY3JlYXRlT3NjaWxsYXRvcigpOwogICAgICAgIGxldCBnYWluID0gYXVkaW9DdHguY3JlYXRlR2FpbigpOwogICAgICAgIG9zYy5jb25uZWN0KGdhaW4pOwogICAgICAgIGdhaW4uY29ubmVjdChhdWRpb0N0eC5kZXN0aW5hdGlvbik7CiAgICAgICAgCiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gYXVkaW9DdHguY3VycmVudFRpbWUgKyAwLjU7CiAgICAgICAgY29uc3QgYml0RHVyYXRpb24gPSAxIC8gQ09ORklHLmJhdWRSYXRlOwoKICAgICAgICBiaXRzLnNwbGl0KCcnKS5mb3JFYWNoKChiaXQsIGkpID0+IHsKICAgICAgICAgICAgY29uc3QgdCA9IHN0YXJ0VGltZSArIChpICogYml0RHVyYXRpb24pOwogICAgICAgICAgICBvc2MuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKChiaXQgPT09ICcxJyA/IENPTkZJRy5mcmVxMSA6IENPTkZJRy5mcmVxMCksIHQpOwogICAgICAgIH0pOwoKICAgICAgICBvc2Muc3RhcnQoc3RhcnRUaW1lKTsKICAgICAgICBvc2Muc3RvcChzdGFydFRpbWUgKyAoYml0cy5sZW5ndGggKiBiaXREdXJhdGlvbikpOwogICAgICAgIAogICAgICAgIG9zYy5vbmVuZGVkID0gKCkgPT4gbG9nKCJUcmFuc21pc2nDs24gZmluYWxpemFkYS4iKTsKICAgIH0pOwoKICAgIC8vIC0tLSBMw5NHSUNBIERFTCBSRUNFUFRPUiAtLS0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5MaXN0ZW4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICBhdWRpb0N0eCA9IG5ldyAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSgpOwogICAgICAgIGNvbnN0IHN0cmVhbSA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHsgYXVkaW86IHsgZWNob0NhbmNlbGxhdGlvbjogZmFsc2UsIG5vaXNlU3VwcHJlc3Npb246IGZhbHNlIH0gfSk7CiAgICAgICAgCiAgICAgICAgY29uc3Qgc291cmNlID0gYXVkaW9DdHguY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2Uoc3RyZWFtKTsKICAgICAgICBjb25zdCBhbmFseXNlciA9IGF1ZGlvQ3R4LmNyZWF0ZUFuYWx5c2VyKCk7CiAgICAgICAgYW5hbHlzZXIuZmZ0U2l6ZSA9IDIwNDg7CiAgICAgICAgc291cmNlLmNvbm5lY3QoYW5hbHlzZXIpOwoKICAgICAgICAvLyBWaXN1YWxpemFkb3IKICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlzdWFsaXplcicpOwogICAgICAgIGNvbnN0IGNhbnZhc0N0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IGFuYWx5c2VyLmZyZXF1ZW5jeUJpbkNvdW50OwogICAgICAgIGNvbnN0IGRhdGFBcnJheSA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlckxlbmd0aCk7CgogICAgICAgIGxvZygiRXNjdWNoYW5kby4uLiBFc3BlcmFuZG8gc2VjdWVuY2lhIGRlIGluaWNpby4iKTsKICAgICAgICAKICAgICAgICBsZXQgcmVjZWl2ZWRCaXRzID0gIiI7CiAgICAgICAgbGV0IGlzUmVjZWl2aW5nID0gZmFsc2U7CiAgICAgICAgbGV0IHNpbGVuY2VDb3VudCA9IDA7CiAgICAgICAgbGV0IGxhc3RCaXQgPSAiIjsKICAgICAgICAKICAgICAgICAvLyBWYXJpYWJsZXMgcGFyYSBtdWVzdHJlbyByb2J1c3RvICh2b3RvIHBvciBtYXlvcsOtYSkKICAgICAgICBsZXQgc2FtcGxlcyA9IFtdOyAKICAgICAgICBjb25zdCBzYW1wbGVzUGVyQml0ID0gTWF0aC5mbG9vcihhdWRpb0N0eC5zYW1wbGVSYXRlIC8gMjA0OCAqICgxL0NPTkZJRy5iYXVkUmF0ZSkpOyAvLyBBcHJveGltYWNpw7NuCgogICAgICAgIGZ1bmN0aW9uIGRlbW9kdWxhdGUoKSB7CiAgICAgICAgICAgIGFuYWx5c2VyLmdldEJ5dGVGcmVxdWVuY3lEYXRhKGRhdGFBcnJheSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEaWJ1amFyIHZpc3VhbGl6YWRvcgogICAgICAgICAgICBjYW52YXNDdHguZmlsbFN0eWxlID0gJyMyMjInOwogICAgICAgICAgICBjYW52YXNDdHguZmlsbFJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgY2FudmFzQ3R4LmZpbGxTdHlsZSA9ICcjMGYwJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEVuY29udHJhciBwaWNvIGRlIGZyZWN1ZW5jaWEKICAgICAgICAgICAgbGV0IG1heFZhbCA9IDA7CiAgICAgICAgICAgIGxldCBtYXhJbmRleCA9IDA7CiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPGJ1ZmZlckxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZihkYXRhQXJyYXlbaV0gPiBtYXhWYWwpIHsgbWF4VmFsID0gZGF0YUFycmF5W2ldOyBtYXhJbmRleCA9IGk7IH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBkb21GcmVxID0gbWF4SW5kZXggKiBhdWRpb0N0eC5zYW1wbGVSYXRlIC8gYW5hbHlzZXIuZmZ0U2l6ZTsKCiAgICAgICAgICAgIC8vIERpYnVqYXIgYmFycmEgZGUgZnJlY3VlbmNpYSBkb21pbmFudGUKICAgICAgICAgICAgY29uc3QgeCA9IChkb21GcmVxIC8gMzAwMCkgKiBjYW52YXMud2lkdGg7CiAgICAgICAgICAgIGNhbnZhc0N0eC5maWxsUmVjdCh4LCAwLCA1LCBjYW52YXMuaGVpZ2h0KTsKCiAgICAgICAgICAgIC8vIFVtYnJhbCBkZSBydWlkbwogICAgICAgICAgICBpZiAobWF4VmFsID4gNTApIHsgLy8gU2kgaGF5IHNvbmlkbyBmdWVydGUKICAgICAgICAgICAgICAgIGxldCBiaXQgPSAiPyI7CiAgICAgICAgICAgICAgICAvLyBUb2xlcmFuY2lhIGRlICsvLSAyMDBIegogICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRvbUZyZXEgLSBDT05GSUcuZnJlcTEpIDwgMjAwKSBiaXQgPSAiMSI7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChNYXRoLmFicyhkb21GcmVxIC0gQ09ORklHLmZyZXEwKSA8IDIwMCkgYml0ID0gIjAiOwoKICAgICAgICAgICAgICAgIGlmKGJpdCAhPT0gIj8iKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTMOzZ2ljYSBzaW1wbGUgZGUgbXVlc3RyZW86IEVzcGVyYW1vcyBlc3RhYmlsaWRhZAogICAgICAgICAgICAgICAgICAgIHNhbXBsZXMucHVzaChiaXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2FtcGxlcy5wdXNoKCJzaWxlbmNlIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFByb2Nlc2FyIG11ZXN0cmFzIGNhZGEgWCB0aWVtcG8gKFNpbXVsYWNpw7NuIGRlIHJlbG9qKQogICAgICAgICAgICAvLyBOb3RhOiBFbiB1biBzaXN0ZW1hIHJlYWwgc2UgcmVxdWllcmUgc2luY3Jvbml6YWNpw7NuIGRlIGZhc2UgKFBMTCkKICAgICAgICAgICAgLy8gQXF1w60gdXNhbW9zIHVuIHByb21lZGlvIHNpbXBsZSBwYXJhIGRlbW9zdHJhY2nDs24gZW4gSlMgcHVybwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRW4gZXN0YSBkZW1vIHNpbXBsaWZpY2FkYSwgZGV0ZWN0YW1vcyBjYW1iaW9zIGRlIGVzdGFkbyBsYXJnb3MKICAgICAgICAgICAgLy8gUGFyYSAicHJvZHVjY2nDs24iIGVuIEpTLCBzZSByZWNvbWllbmRhIGdyYWJhciBlbCBidWZmZXIgY29tcGxldG8geSBhbmFsaXphcmxvIG9mZmxpbmUuCiAgICAgICAgICAgIAogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZGVtb2R1bGF0ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIE5PVEEgSU1QT1JUQU5URSBQQVJBIEVMIFVTVUFSSU86CiAgICAgICAgLy8gTGEgZGVtb2R1bGFjacOzbiBlbiB0aWVtcG8gcmVhbCBleGFjdGEgZW4gSlMgcHVybyBlcyBleHRyZW1hZGFtZW50ZSBkaWbDrWNpbCBkZWJpZG8KICAgICAgICAvLyBhbCBKaXR0ZXIgZGVsIG5hdmVnYWRvci4gCiAgICAgICAgLy8gUGFyYSBlc3RhIGRlbW8sIHVzYXJlbW9zIHVuIGVuZm9xdWUgZGUgIkJ1ZmZlciBHcmFiYmVyIiBzaW1wbGlmaWNhZG86CiAgICAgICAgLy8gRGV0ZWN0YXIgc2kgbGEgZW5lcmfDrWEgZXN0w6EgZW4gMTUwMCBvIDI1MDAgeSBhZ3JlZ2FyIGEgdW4gc3RyaW5nIGNydWRvLCBsdWVnbyBmaWx0cmFyLgogICAgICAgIAogICAgICAgIGNvbnN0IHByb2Nlc3NvciA9IGF1ZGlvQ3R4LmNyZWF0ZVNjcmlwdFByb2Nlc3Nvcig0MDk2LCAxLCAxKTsKICAgICAgICBzb3VyY2UuY29ubmVjdChwcm9jZXNzb3IpOwogICAgICAgIHByb2Nlc3Nvci5jb25uZWN0KGF1ZGlvQ3R4LmRlc3RpbmF0aW9uKTsKICAgICAgICAKICAgICAgICBsZXQgc2lnbmFsQnVmZmVyID0gIiI7CiAgICAgICAgbGV0IGZyYW1lc0NvdW50ZXIgPSAwOwogICAgICAgIAogICAgICAgIHByb2Nlc3Nvci5vbmF1ZGlvcHJvY2VzcyA9IChlKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZS5pbnB1dEJ1ZmZlci5nZXRDaGFubmVsRGF0YSgwKTsKICAgICAgICAgICAgLy8gQW7DoWxpc2lzIEZGVCBtYW51YWwgc2ltcGxpZmljYWRvIChHb2VydHplbCBzZXLDrWEgbWVqb3IsIHBlcm8gZXN0byBlcyBtw6FzIGNvcnRvKQogICAgICAgICAgICAvLyBTb2xvIG1pcmFtb3MgY3J1Y2VzIHBvciBjZXJvIG8gZW5lcmfDrWEgYsOhc2ljYSBubyBmdW5jaW9uYXLDoSBiaWVuLgogICAgICAgICAgICAvLyBWb2x2ZW1vcyBhbCBBbmFseXNlck5vZGUgcGVybyBjb250cm9sYWRvIHBvciB0aWVtcG8uCiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvLyBVc2FyZW1vcyBzZXRJbnRlcnZhbCBwYXJhIG11ZXN0cmVhciBlbCBBbmFseXNlck5vZGUgYWwgcml0bW8gZGVsIEJhdWRSYXRlCiAgICAgICAgLy8gRXN0byBlcyAicG9sbGluZyIsIG1lbm9zIHByZWNpc28gcGVybyBmdW5jaW9uYWwgcGFyYSBiYWphIHZlbG9jaWRhZC4KICAgICAgICBjb25zdCBpbnRlcnZhbFRpbWUgPSAxMDAwIC8gQ09ORklHLmJhdWRSYXRlOwogICAgICAgIAogICAgICAgIGxldCBiaXRCdWZmZXIgPSBbXTsKICAgICAgICAKICAgICAgICBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgICAgIGFuYWx5c2VyLmdldEJ5dGVGcmVxdWVuY3lEYXRhKGRhdGFBcnJheSk7CiAgICAgICAgICAgIGxldCBtYXhWYWwgPSAwOwogICAgICAgICAgICBsZXQgbWF4SW5kZXggPSAwOwogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxidWZmZXJMZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYoZGF0YUFycmF5W2ldID4gbWF4VmFsKSB7IG1heFZhbCA9IGRhdGFBcnJheVtpXTsgbWF4SW5kZXggPSBpOyB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZnJlcSA9IG1heEluZGV4ICogYXVkaW9DdHguc2FtcGxlUmF0ZSAvIGFuYWx5c2VyLmZmdFNpemU7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZihtYXhWYWwgPiAxMDApIHsKICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhmcmVxIC0gQ09ORklHLmZyZXExKSA8IDI1MCkgYml0QnVmZmVyLnB1c2goIjEiKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKE1hdGguYWJzKGZyZXEgLSBDT05GSUcuZnJlcTApIDwgMjUwKSBiaXRCdWZmZXIucHVzaCgiMCIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgaW50ZXJ2YWxUaW1lKTsgLy8gTXVlc3RyZWFyIGV4YWN0YW1lbnRlIGVuIGVsIG1lZGlvIGRlbCBiaXQgKHRlw7NyaWNhbWVudGUpCgogICAgICAgIC8vIEhpbG8gZGUgcHJvY2VzYW1pZW50byBkZSBiaXRzIHJlY2liaWRvcwogICAgICAgIHNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgICAgaWYoYml0QnVmZmVyLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJpdCA9IGJpdEJ1ZmZlci5zaGlmdCgpOwogICAgICAgICAgICAgICAgcmVjZWl2ZWRCaXRzICs9IGJpdDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0ZpbGwnKS5zdHlsZS53aWR0aCA9IChyZWNlaXZlZEJpdHMubGVuZ3RoICUgMTAwKSArICIlIjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gSW50ZW50YXIgZGVjb2RpZmljYXIgY2FkYSA4IGJpdHMgc2kgcGFyZWNlIHF1ZSBoZW1vcyB0ZXJtaW5hZG8KICAgICAgICAgICAgICAgIGlmKHJlY2VpdmVkQml0cy5sZW5ndGggPiAxMDAgJiYgcmVjZWl2ZWRCaXRzLmxlbmd0aCAlIDggPT09IDApIHsKICAgICAgICAgICAgICAgICAgIHRyeVBhcnNlKHJlY2VpdmVkQml0cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LCAxMDApOwoKICAgICAgICBkZW1vZHVsYXRlKCk7IC8vIFNvbG8gcGFyYSBlZmVjdG9zIHZpc3VhbGVzCiAgICB9KTsKCiAgICBmdW5jdGlvbiB0cnlQYXJzZShiaXRzKSB7CiAgICAgICAgLy8gQnVzY2FyIGVsIHByZcOhbWJ1bG8KICAgICAgICBjb25zdCBwcmVhbWJsZUluZGV4ID0gYml0cy5pbmRleE9mKENPTkZJRy5zdGFydFNlcSk7CiAgICAgICAgaWYocHJlYW1ibGVJbmRleCA9PT0gLTEpIHJldHVybjsKCiAgICAgICAgY29uc3QgcGF5bG9hZEJpdHMgPSBiaXRzLnN1YnN0cmluZyhwcmVhbWJsZUluZGV4ICsgQ09ORklHLnN0YXJ0U2VxLmxlbmd0aCk7CiAgICAgICAgaWYocGF5bG9hZEJpdHMubGVuZ3RoICUgOCAhPT0gMCkgcmV0dXJuOwoKICAgICAgICBjb25zdCByYXdUZXh0ID0gYml0c1RvVGV4dChwYXlsb2FkQml0cyk7CiAgICAgICAgCiAgICAgICAgLy8gQnVzY2Ftb3MgZWwgZmluYWwgIkVORCIKICAgICAgICBpZihyYXdUZXh0LmluY2x1ZGVzKCJ8RU5EIikpIHsKICAgICAgICAgICAgY29uc3QgcGFydHMgPSByYXdUZXh0LnNwbGl0KCJ8Iik7CiAgICAgICAgICAgIGlmKHBhcnRzLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcGFydHNbMF07IC8vIEJhc2U2NCBkZWwgYXJjaGl2bwogICAgICAgICAgICAgICAgY29uc3QgcmVjZWl2ZWRDUkMgPSBwYXJ0c1sxXTsgLy8gQ1JDIGhleGFkZWNpbWFsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZygiUGFxdWV0ZSBkZXRlY3RhZG8uIFZlcmlmaWNhbmRvIGludGVncmlkYWQuLi4iKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgY2FsY3VsYXRlZENSQyA9IGNyYzMyKGRhdGEpLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCByZXNEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncnhSZXN1bHQnKTsKICAgICAgICAgICAgICAgIGlmKGNhbGN1bGF0ZWRDUkMgPT09IHJlY2VpdmVkQ1JDKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nKCLinIUgSU5URUdSSURBRCBWRVJJRklDQURBLiBDUkMgT0suIik7CiAgICAgICAgICAgICAgICAgICAgcmVzRGl2LmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0ic3VjY2VzcyI+w4l4aXRvOiBFbCBhcmNoaXZvIGVzIHBlcmZlY3RvLiA8YSBocmVmPSIke2RhdGF9IiBkb3dubG9hZD0iYXJjaGl2b19yZWNpYmlkbyI+RGVzY2FyZ2FyPC9hPjwvc3Bhbj5gOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2coYOKdjCBFUlJPUiBERSBJTlRFR1JJREFELiBSZWNpYmlkbzogJHtyZWNlaXZlZENSQ30sIENhbGN1bGFkbzogJHtjYWxjdWxhdGVkQ1JDfWApOwogICAgICAgICAgICAgICAgICAgIHJlc0Rpdi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9ImVycm9yIj5FcnJvcjogQXJjaGl2byBjb3JydXB0byAoQ1JDIG1pc21hdGNoKS4gSW50ZW50YSBkZSBudWV2by48L3NwYW4+YDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTGltcGlhciBidWZmZXIgcGFyYSBldml0YXIgbcO6bHRpcGxlcyBkZXRlY2Npb25lcwogICAgICAgICAgICAgICAgcmVjZWl2ZWRCaXRzID0gIiI7IAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQo8L3NjcmlwdD4KCjwvYm9keT4KPC9odG1sPg==
